<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>HA LVM cluster build - My Docs</title>
  

  <link rel="shortcut icon" href="../../../img/favicon.ico">

  
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="../../../css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../css/theme_extra.css" type="text/css" />
  <link rel="stylesheet" href="../../../css/highlight.css">
  <link href="../../../networking/build/css/freezeframe_styles.css" rel="stylesheet">
  <link href="../../../networking/build/css/freezeframe_styles.min.css" rel="stylesheet">
  <link href="../../../networking/freezeframe.js/build/css/freezeframe_styles.css" rel="stylesheet">
  <link href="../../../networking/freezeframe.js/build/css/freezeframe_styles.min.css" rel="stylesheet">

  
  <script>
    // Current page data
    var mkdocs_page_name = "HA LVM cluster build";
  </script>
  
  <script src="../../../js/jquery-2.1.1.min.js"></script>
  <script src="../../../js/modernizr-2.8.3.min.js"></script>
  <script type="text/javascript" src="../../../js/highlight.pack.js"></script>
  <script src="../../../js/theme.js"></script> 
  <script src="../../../networking/build/js/freezeframe.js"></script>
  <script src="../../../networking/build/js/freezeframe.min.js"></script>
  <script src="../../../networking/build/js/freezeframe.pkgd.js"></script>
  <script src="../../../networking/build/js/freezeframe.pkgd.min.js"></script>
  <script src="../../../networking/freezeframe.js/gulpfile.js"></script>
  <script src="../../../networking/freezeframe.js/build/js/freezeframe.js"></script>
  <script src="../../../networking/freezeframe.js/build/js/freezeframe.min.js"></script>
  <script src="../../../networking/freezeframe.js/build/js/freezeframe.pkgd.js"></script>
  <script src="../../../networking/freezeframe.js/build/js/freezeframe.pkgd.min.js"></script>
  <script src="../../../networking/freezeframe.js/src/js/freezeframe.js"></script>
  <script src="../../../networking/freezeframe.js/src/js/vendor/imagesloaded.pkgd.js"></script>
  <script src="../../../networking/freezeframe.js/src/js/vendor/jquery-2.1.4.js"></script>
  <script src="../../../networking/src/js/freezeframe.js"></script>
  <script src="../../../networking/src/js/vendor/imagesloaded.pkgd.js"></script>
  <script src="../../../networking/src/js/vendor/jquery-2.1.4.js"></script>

  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
      <div class="wy-side-nav-search">
        <a href="../../.." class="icon icon-home"> My Docs</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
        <ul class="current">
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../../..">Home</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../../../map/">Map</a>
        
    </li>
<li>
          
            <li>
    <ul class="subnav">
    <li><span>Programming</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../../programming/map/">Map</a>
        
    </li>

        
            
    <ul class="subnav">
    <li><span>C programming</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../../programming/c_programming/fork_and_maloc_demo/">Fork and maloc demo</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../../programming/c_programming/fork_demo_menu/">Fork demo menu</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../../programming/c_programming/linux_clocksource_benchmark/">Linux clocksource benchmark</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../../programming/c_programming/programmable_keyboard/">Programmable keyboard</a>
        
    </li>

        
    </ul>

        
    </ul>
<li>
          
            <li>
    <ul class="subnav">
    <li><span>Puppet</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../../puppet/puppet_study_notes/">Puppet study notes</a>
        
    </li>

        
    </ul>
<li>
          
            <li>
    <ul class="subnav">
    <li><span>Scripting</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../../scripting/Column_tally/">Column tally</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../../scripting/Convert_kilobytes_to_MB_GB_TB_PB/">Convert kilobytes to MB GB TB PB</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../../scripting/DNS_validate_entries/">DNS validate entries</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../../scripting/IP_survey/">IP survey</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../../scripting/Shuffle_deck_of_cards/">Shuffle deck of cards</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../../scripting/bash_and_grep_script_to_compare_2_lists/">Bash and grep script to compare 2 lists</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../../scripting/bash_argument_shift_until_loop/">Bash argument shift until loop</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../../scripting/bash_argument_shift_while_loop/">Bash argument shift while loop</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../../scripting/bash_arguments/">Bash arguments</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../../scripting/bash_capture_keyboard_entry/">Bash capture keyboard entry</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../../scripting/bash_case/">Bash case</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../../scripting/bash_fail_and_exit/">Bash fail and exit</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../../scripting/bash_fail_trap/">Bash fail trap</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../../scripting/bash_function/">Bash function</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../../scripting/bash_functions/">Bash functions</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../../scripting/bash_local_vs_global_variables/">Bash local vs global variables</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../../scripting/bash_nested_if_else/">Bash nested if else</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../../scripting/bash_read_input/">Bash read input</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../../scripting/bash_scripting/">Bash scripting</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../../scripting/bash_select/">Bash select</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../../scripting/bash_sort/">Bash sort</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../../scripting/bash_string_comparison/">Bash string comparison</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../../scripting/bash_test_to_only_run_as_root/">Bash test to only run as root</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../../scripting/bash_tips/">Bash tips</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../../scripting/bash_trap_user_ctrl-c/">Bash trap user ctrl c</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../../scripting/bash_wait_for_user_input/">Bash wait for user input</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../../scripting/diff/">Diff</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../../scripting/expect/">Expect</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../../scripting/map/">Map</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../../scripting/script_to_markdown/">Script to markdown</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../../scripting/simulate_site_failure/">Simulate site failure</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../../scripting/use_a_file_to_control_bash_script_operation/">Use a file to control bash script operation</a>
        
    </li>

        
    </ul>
<li>
          
            <li>
    <ul class="subnav">
    <li><span>Networking</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../../networking/traceroute_animation_1_and_2_routers/">Traceroute animation 1 and 2 routers</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../../networking/traceroute_animation_1_router/">Traceroute animation 1 router</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../../networking/traceroute_animation_2_routers/">Traceroute animation 2 routers</a>
        
    </li>

        
    </ul>
<li>
          
            <li>
    <ul class="subnav">
    <li><span>Linux</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../hot_add_memory_and_cpus/">Hot add memory and cpus</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../linux_proccess_signaling/">Linux proccess signaling</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../map/">Map</a>
        
    </li>

        
            
    <ul class="subnav">
    <li><span>Networking</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../Networking/check_dns_records/">Check dns records</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../Networking/determine_the_routes_a_packet_will_take/">Determine the routes a packet will take</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../Networking/linux_networking/">Linux networking</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../Networking/local_IP_address_survey/">local IP address survey</a>
        
    </li>

        
    </ul>

        
            
    <ul class="subnav">
    <li><span>Firewalls and Security</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../Firewalls_and_Security/auditd_rules/">Auditd rules</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../Firewalls_and_Security/iptables_notes/">Iptables notes</a>
        
    </li>

        
    </ul>

        
            
    <ul class="subnav">
    <li><span>Software Packaging</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../Software_Packaging/apt_get/">Apt get</a>
        
    </li>

        
    </ul>

        
            
    <ul class="subnav">
    <li><span>Core Utils</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../Core_Utils/awk/">Awk</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../Core_Utils/bash_shortcuts/">Bash shortcuts</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../Core_Utils/rename/">Rename</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../Core_Utils/spacecmd_breaking_up_large_groups_of_hosts_with_awk/">Spacecmd breaking up large groups of hosts with awk</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../Core_Utils/user_creation/">User creation</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../Core_Utils/watch_and_timeout/">Watch and timeout</a>
        
    </li>

        
    </ul>

        
            
    <ul class="subnav">
    <li><span>Clustering</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../HA_LVM_automatic_failover/">HA LVM automatic failover</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../HA_LVM_automatic_failover_manual_fence_override/">HA LVM automatic failover manual fence override</a>
        
    </li>

        
            
    <li class="toctree-l1 current">
        <a class="current" href="./">HA LVM cluster build</a>
        
            <ul>
            
                <li class="toctree-l3"><a href="#rhel-57-ha-lvm-cluster-setup-guide">RHEL 5.7 HA-LVM cluster setup guide</a></li>
                
                    <li><a class="toctree-l4" href="#ensure-ntp-is-working-correctly">Ensure NTP is working correctly,</a></li>
                
                    <li><a class="toctree-l4" href="#download-and-install-the-certificates-for-the-signed-rpm-packages">Download and install the certificates for the signed RPM packages</a></li>
                
                    <li><a class="toctree-l4" href="#ensure-the-that-the-redhat-certificate-is-installed-not-installed-by-default">Ensure the that the RedHat certificate is installed # not installed by default</a></li>
                
                    <li><a class="toctree-l4" href="#if-not-you-may-get-errors-like">if not you may get errors like...</a></li>
                
                    <li><a class="toctree-l4" href="#register-the-server-with-the-redhat-satellite-server-using-one-of-the-following-keys">Register the server with the RedHat satellite server using one of the following keys</a></li>
                
                    <li><a class="toctree-l4" href="#check-if-the-repo-access-is-working">check if the repo access is working</a></li>
                
                    <li><a class="toctree-l4" href="#install-the-addons">Install the addons...</a></li>
                
                    <li><a class="toctree-l4" href="#fixing-the-inconsistent-path-ordering-when-using-friendly_names-and-a-separate-var-partition-on-rhel-5">Fixing the inconsistent path ordering when using friendly_names and a separate var partition on RHEL 5</a></li>
                
                    <li><a class="toctree-l4" href="#solution-work-around">solution (work around)</a></li>
                
                    <li><a class="toctree-l4" href="#add-the-following-lines-to-multipath-config-to-set-netapp-specific-settings">add the following lines to multipath config to set netapp specific settings</a></li>
                
                    <li><a class="toctree-l4" href="#final-multipathconf-file-should-look-somthing-like">Final multipath.conf file should look somthing like</a></li>
                
                    <li><a class="toctree-l4" href="#change-fstab">Change fstab</a></li>
                
                    <li><a class="toctree-l4" href="#cluster-preconfiguration">Cluster preconfiguration...</a></li>
                
                    <li><a class="toctree-l4" href="#ensure-ntp-is-working-correctly_1">Ensure NTP is working correctly,</a></li>
                
                    <li><a class="toctree-l4" href="#install-cluster-software-and-fencing-tools">Install cluster software and fencing tools</a></li>
                
                    <li><a class="toctree-l4" href="#disable-the-cluster-from-starting-up-until-you-have-finished-the-config">Disable the cluster from starting up... until you have finished the config</a></li>
                
                    <li><a class="toctree-l4" href="#edit-firewall-rules-to-allow-cluster-traffic">Edit firewall rules to allow cluster traffic</a></li>
                
                    <li><a class="toctree-l4" href="#configure-the-privateheartbeat-nic">Configure the private/heartbeat nic</a></li>
                
                    <li><a class="toctree-l4" href="#define-which-multicast-address-to-use-for-the-cluster">Define which multicast address to use for the cluster</a></li>
                
                    <li><a class="toctree-l4" href="#add-the-private-hostnamesdomains-to-etchosts">Add the private hostnames/domains to /etc/hosts</a></li>
                
                    <li><a class="toctree-l4" href="#starting-ricciluci">Starting ricci/luci</a></li>
                
                    <li><a class="toctree-l4" href="#simple-clusterconf-file-to-get-you-started">Simple cluster.conf file to get you started</a></li>
                
                    <li><a class="toctree-l4" href="#configure-fencing">Configure fencing</a></li>
                
                    <li><a class="toctree-l4" href="#setup-ha-lvm">setup HA-LVM</a></li>
                
                    <li><a class="toctree-l4" href="#edit-etclvmlvmconf">edit /etc/lvm/lvm.conf</a></li>
                
                    <li><a class="toctree-l4" href="#create-the-pv-vg-lv-and-filesystems-from-one-of-the-nodes">Create the PV VG LV and filesystems from one of the nodes</a></li>
                
            
            </ul>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../HA_LVM_cluster_build_guide/">HA LVM cluster build guide</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../HA_LVM_manual_failover.txt/">HA LVM manual failover.txt</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../RHEL4_cluster_installation/">RHEL4 cluster installation</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../cluster_website/">Cluster website</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../homemade_cluster/">Homemade cluster</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../simple.cluster.conf/">Simple.cluster.conf</a>
        
    </li>

        
    </ul>

        
            
    <ul class="subnav">
    <li><span>Time</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../Time/Adventures_in_the_land_of_symmetric_ntp_authentication/">Adventures in the land of symmetric ntp authentication</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../Time/Setting_time/">Setting time</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../Time/linux_clocksource_benchmark-2.c/">Linux clocksource benchmark 2.c</a>
        
    </li>

        
    </ul>

        
            
    <ul class="subnav">
    <li><span>RedHat</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../RedHat/kickstart/">Kickstart</a>
        
    </li>

        
            
    <ul class="subnav">
    <li><span>Satellite spacewalk</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../RedHat/satellite_spacewalk/perl_script_to_calulate_uptime_of_satellite_clients/">Perl script to calulate uptime of satellite clients</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../RedHat/satellite_spacewalk/replacing_your_satellite_certificate/">Replacing your satellite certificate</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../RedHat/satellite_spacewalk/satellite_certificate_licence_install/">Satellite certificate licence install</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../RedHat/satellite_spacewalk/using_spacecmd/">Using spacecmd</a>
        
    </li>

        
    </ul>

        
            
    <ul class="subnav">
    <li><span>Yum rpm</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../RedHat/yum_rpm/create_local_repos_from_redhat_install_media/">Create local repos from redhat install media</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../RedHat/yum_rpm/working_with_yum_and_rpm/">Working with yum and rpm</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../RedHat/yum_rpm/yum_and_rpm/">Yum and rpm</a>
        
    </li>

        
    </ul>

        
    </ul>

        
            
    <ul class="subnav">
    <li><span>Commands</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../Commands/email_on_linux/">Email on linux</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../Commands/hot_add_memory/">Hot add memory</a>
        
    </li>

        
    </ul>

        
            
    <ul class="subnav">
    <li><span>Monitoring</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../Monitoring/nagios_2.6_install/">Nagios 2.6 install</a>
        
    </li>

        
    </ul>

        
            
    <ul class="subnav">
    <li><span>Disks and File Systems</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../Disks_and_File_Systems/Extend_lvm_filesystem/">Extend lvm filesystem</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../Disks_and_File_Systems/Linux_LVM_Logical_Volume_Manager/">Linux LVM Logical Volume Manager</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../Disks_and_File_Systems/Listing_Oracle_ASM_disks/">Listing Oracle ASM disks</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../Disks_and_File_Systems/Multipath_and_NetApp_fixes/">Multipath and NetApp fixes</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../Disks_and_File_Systems/Online_lun_resize/">Online lun resize</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../Disks_and_File_Systems/RHEL_floppy_kickstart/">RHEL floppy kickstart</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../Disks_and_File_Systems/boot_cdrom_dvdrom/">Boot cdrom dvdrom</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../Disks_and_File_Systems/disk_filesystem_partition_imaging_using_squashfs_and_dd/">Disk filesystem partition imaging using squashfs and dd</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../Disks_and_File_Systems/filesystem_shuffle/">Filesystem shuffle</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../Disks_and_File_Systems/rsync/">Rsync</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../Disks_and_File_Systems/shrink_lvm_filesystem/">Shrink lvm filesystem</a>
        
    </li>

        
    </ul>

        
    </ul>
<li>
          
        </ul>
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../../..">My Docs</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../../..">Docs</a> &raquo;</li>
    
      
        
          <li>Clustering &raquo;</li>
        
      
    
    <li>HA LVM cluster build</li>
    <li class="wy-breadcrumbs-aside">
      
    </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h2 id="rhel-57-ha-lvm-cluster-setup-guide">RHEL 5.7 HA-LVM cluster setup guide</h2>
<p><strong>version 201600508</strong>
<strong>created by Seamus Murray</strong></p>
<p>After manually building the server via multiple RDP sessions and KVM consoles you sometimes have typos or duplicate key strokes in config files.
Before going further, you should ensure that all the hostname's IP address gateways etc are correct..</p>
<ul>
<li>ensure the host name is correct and a FQDN in /etc/sysconfig/network</li>
<li>ensure hostname is not in any of the ifcfg-ethx files </li>
<li>ensure hostname is not listed against loopback address in /etc/hosts #RedHat installer put this in by default</li>
<li><em>restart network services, run hostname command manually or reboot if necessary</em></li>
</ul>
<h3 id="ensure-ntp-is-working-correctly">Ensure NTP is working correctly,</h3>
<h4 id="you-may-need-to-manually-sync-the-time">You may need to manually sync the time</h4>
<pre><code>service ntp stop
ntpdate 192.168.100.1 
ntpdate 192.168.100.2 
service ntp start
</code></pre>
<p><strong>Important</strong> , Due to the application vendor support requirements, the cluster servers need to remain on RHEL 5.7.
ie, they cannot be updated to RHEL 5.8 or 5.9
To ensure the hosts stay on RHEL 5.7 there has been a dedicated software channel created for this specific project.
The hosts have to be registered against this specific channel.... if they subscribe to the main RHEL 5.x channel they will be updated to the latest package versions which will make then unsupportable from the application vendors perspective.</p>
<ul>
<li>rhel-x86_64-server-5_7 </li>
<li>Clone Red Hat Network Tools for RHEL Server (v.5.7 64-bit x86_64) </li>
<li>rhel-x86_64-server-cluster-5_7 </li>
</ul>
<h3 id="download-and-install-the-certificates-for-the-signed-rpm-packages">Download and install the certificates for the signed RPM packages</h3>
<pre><code>wget --no-check-certificate https://satellite1.local/pub/rhn-org-trusted-ssl-cert-1.0-1.noarch.rpm
wget --no-check-certificate https://satellite1.local/pub/rpm-gpg-key-1.0-7.noarch.rpm
rpm -Uvh rhn-org-trusted-ssl-cert-1.0-1.noarch.rpm rpm-gpg-key-corp-1.0-7.noarch.rpm
sed -i 's/^\(sslCACert=\).*/\1\/usr\/share\/rhn\/RHN-ORG-TRUSTED-SSL-CERT/' /etc/sysconfig/rhn/up2date
</code></pre>
<h3 id="ensure-the-that-the-redhat-certificate-is-installed-not-installed-by-default">Ensure the that the RedHat certificate is installed # not installed by default</h3>
<pre><code>rpm --import /etc/pki/rpm-gpg/RPM-GPG-KEY-redhat-release
</code></pre>
<h3 id="if-not-you-may-get-errors-like"><strong>if not you may get errors like...</strong></h3>
<pre><code>Public key for mkinitrd-5.1.19.6-79.el5.i386.rpm is not installed
</code></pre>
<h3 id="register-the-server-with-the-redhat-satellite-server-using-one-of-the-following-keys">Register the server with the RedHat satellite server using one of the following keys</h3>
<pre><code>rhnreg_ks --activationkey 1-bc5fb717c87abcdefghijklm --serverUrl https://satellite1.local/XMLRPC
rhnreg_ks --activationkey 1-5bbf25c4abcdefghijklm123 --serverUrl https://satellite1.local/XMLRPC
</code></pre>
<h3 id="check-if-the-repo-access-is-working">check if the repo access is working</h3>
<pre><code>yum clean all
yum list
</code></pre>
<h3 id="install-the-addons">Install the addons...</h3>
<pre><code>yum install java-1.6.0-openjdk
yum install samba3x-winbind  iptables lsof krb5-workstation pam_passwdqc xauth
yum install ipv6-disable
</code></pre>
<h3 id="fixing-the-inconsistent-path-ordering-when-using-friendly_names-and-a-separate-var-partition-on-rhel-5">Fixing the inconsistent path ordering when using friendly_names and a separate var partition on RHEL 5</h3>
<h4 id="cause">cause</h4>
<ul>
<li>RHEL 5 multipath bindings file is located in var</li>
<li>/var isn't mounted before multipath is configured</li>
<li>redhat does not include /var/lib/ in the initial ram disk which breaks multipath on boot</li>
</ul>
<h3 id="solution-work-around">solution (work around)</h3>
<p>Edit the /etc/multipath.conf</p>
<h3 id="add-the-following-lines-to-multipath-config-to-set-netapp-specific-settings">add the following lines to multipath config to set netapp specific settings</h3>
<pre><code>defaults {
    user_friendly_names yes
    bindings_file /etc/multipath/bindings ##changed 
    flush_on_last_del       yes
    max_fds max
    pg_prio_calc    avg
    queue_without_daemon    no
}


devices {

    device {
            vendor                  "NETAPP"
            product                 "LUN"
            path_checker            tur
            path_selector           "round-robin 0"
            getuid_callout          "/sbin/scsi_id -g -u -s /block/%n"
#           prio_callout            "/sbin/mpath_prio_ontap /dev/%n"
            prio_callout            "/sbin/mpath_prio_alua /dev/%n"
#           features                "1 queue_if_no_path"
            features                "3 queue_if_no_path pg_init_retries 50"
#           hardware_handler        "0"
            hardware_handler        "1 alua"
            path_grouping_policy    group_by_prio
            failback                immediate
            rr_weight               uniform
            rr_min_io               128
    }

}




mkdir /etc/multipath
cp /var/lib/multipath/bindings /etc/multipath/bindings
cd /boot
cp initrd*img initrd*img.multipath-bak
mkinitrd -f initrd-`uname -r`.img `uname -r`
ls -ltr  #make sure the file is correct size there seems to be a bug where it intermittently creates a initrd of half the size
</code></pre>
<p>edit the multipath bindings and ensure the shared luns have the same friendly names across all nodes
recreate initial ram disk image
reboot all nodes and ensure all nodes see the luns at same friendly name </p>
<pre><code>cat /etc/multipath/bindings
# Multipath bindings, Version : 1.0
# NOTE: this file is automatically maintained by the multipath program.
# You should not need to edit this file in normal circumstances.
#
# Format:
# alias wwid
#
mpsys 360a9800037542d73442443123456755
mpath1 360a9800037542d73442443123456757
mpath2 360a9800037542d73442443123456759
mpath3 360a9800037542d7344244312345672f
mpath4 360a9800037542d73442443123456762
mpath5 360a9800037542d73442443123456764
mpath6 360a9800037542d73442443123456766
</code></pre>
<h3 id="final-multipathconf-file-should-look-somthing-like">Final multipath.conf file should look somthing like</h3>
<p>defaults {
        user_friendly_names yes
        bindings_file /etc/multipath/bindings
        flush_on_last_del       yes
        max_fds max
        pg_prio_calc    avg
        queue_without_daemon    no
    }</p>
<pre><code>blacklist {
        devnode "^(ram|raw|loop|fd|md|dm-|sr|scd|st)[0-9]*"
        devnode "^(hd|xvd|vd)[a-z]*"
#        wwid "*"
}

# Make sure our multipath devices are enabled.

blacklist_exceptions {
        wwid "360a9800037542d73442443123456755"
}

multipaths {
        multipath {
        wwid  360a9800037542d73442443123456755
        alias mpsys
        }
}


devices {

       device {
                vendor                  "NETAPP"
                product                 "LUN"
                path_checker            tur
                path_selector           "round-robin 0"
                getuid_callout          "/sbin/scsi_id -g -u -s /block/%n"
#               prio_callout            "/sbin/mpath_prio_ontap /dev/%n"
                prio_callout            "/sbin/mpath_prio_alua /dev/%n"
#               features                "1 queue_if_no_path"
                features                "3 queue_if_no_path pg_init_retries 50"
#               hardware_handler        "0"
                hardware_handler        "1 alua"
                path_grouping_policy    group_by_prio
                failback                immediate
                rr_weight               uniform
                rr_min_io               128
       }

}
</code></pre>
<h3 id="change-fstab">Change fstab</h3>
<pre><code>#/dev/mapper/mpath0p1    /boot                   ext3    defaults        1 2
/dev/mapper/mpsysp1    /boot                   ext3    defaults        1 2
</code></pre>
<h3 id="cluster-preconfiguration">Cluster preconfiguration...</h3>
<h3 id="ensure-ntp-is-working-correctly_1">Ensure NTP is working correctly,</h3>
<p><strong>you may need to manually sync the time</strong>
    service ntp stop
    ntpdate 192.168.0.1
    ntpdate 192.168.0.2 
    service ntp start</p>
<h3 id="install-cluster-software-and-fencing-tools">Install cluster software and fencing tools</h3>
<pre><code>yum install OpenIPMI-tools.x86_64 cman rgmanager lucci ricci
</code></pre>
<h3 id="disable-the-cluster-from-starting-up-until-you-have-finished-the-config">Disable the cluster from starting up... until you have finished the config</h3>
<pre><code>chkconfig --levels 2345 cman off
chkconfig --levels 2345 rgmanager off
chkconfig --levels 2345 ricci off
chkconfig --levels 2345 luci off
</code></pre>
<h3 id="edit-firewall-rules-to-allow-cluster-traffic">Edit firewall rules to allow cluster traffic</h3>
<pre><code>iptables -I INPUT --protocol tcp --dport 22 -j ACCEPT
# Cluster
iptables -I INPUT -p udp -m state --state NEW -m multiport --dports 5404,5405 -j ACCEPT
iptables -I INPUT -p tcp -m state --state NEW -m multiport --dports 11111 -j ACCEPT
iptables -I INPUT -p udp -m state --state NEW -m multiport --dports 50007 -j ACCEPT
iptables -I INPUT -p tcp -m state --state NEW -m multiport --dports 50008 -j ACCEPT
</code></pre>
<p>turn off firewall for private nic
    iptables -I INPUT -i eth1 -j ACCEPT</p>
<p>save the iptables so that they will be persistant </p>
<h3 id="configure-the-privateheartbeat-nic">Configure the private/heartbeat nic</h3>
<p>*add multicast route for private/heartbeat</p>
<pre><code>/etc/sysconfig/network-scripts/route-eth1
239.0.0.0/4 dev eth1
</code></pre>
<h3 id="define-which-multicast-address-to-use-for-the-cluster">Define which multicast address to use for the cluster</h3>
<pre><code>239.192.0.1 for App 1
239.192.0.2 for App 2
239.192.0.3 for App 3
</code></pre>
<h3 id="add-the-private-hostnamesdomains-to-etchosts">Add the private hostnames/domains to /etc/hosts</h3>
<pre><code># cluster nodes
192.168.0.1 hostname1.local  hostname1
10.10.10.1  hostname1.private  hostname1-priv
192.168.0.2 hostname2.local  hostname2
10.10.10.2  hostname2.private  hostname2-priv
192.168.0.3 hostname-vip.local  hostname-vip
</code></pre>
<p><strong>if you want to use luci</strong>
<strong>warning</strong> due to the way the RedHat Satellite server is configured you cannot perform rpm or yum group installs
you have to specify the packages individually, because of this you can not use ricci/luci to create a cluster config
You can use ricci/luci to import an existing cluster
Therefore if you really need the GUI create a simple cluster with no resources or services first then import it into lucci</p>
<h3 id="starting-ricciluci">Starting ricci/luci</h3>
<p>if you have not previously configured a luci account run " /usr/sbin/luci_admin init" and set a password
start up ricci on both servers and luci on one server 
setup putty forwarding from the rdp jump host local port 80 to 127.0.0.1:8084 on the host you will run luci</p>
<p>start browser window https://127.0.0.1:80</p>
<h3 id="simple-clusterconf-file-to-get-you-started">Simple cluster.conf file to get you started</h3>
<pre><code>&lt;?xml version="1.0"?&gt;
&lt;cluster alias="cluster1" config_version="1" name="cluster1"&gt;
        &lt;fence_daemon clean_start="0" post_fail_delay="0" post_join_delay="3"/&gt;
        &lt;clusternodes&gt;
                &lt;clusternode name="hostname1.private" nodeid="1" votes="1"&gt;
                        &lt;fence&gt;
                                &lt;method name="1"&gt;
                                        &lt;device name="ipmi-hostname1"/&gt;
                                &lt;/method&gt;
                        &lt;/fence&gt;
                &lt;/clusternode&gt;
                &lt;clusternode name="hostname2.private" nodeid="2" votes="1"&gt;
                        &lt;fence&gt;
                                &lt;method name="1"&gt;
                                        &lt;device name="ipmi-hostname2"/&gt;
                                &lt;/method&gt;
                        &lt;/fence&gt;
                &lt;/clusternode&gt;
        &lt;/clusternodes&gt;
        &lt;cman expected_votes="1" two_node="1"&gt;
                &lt;multicast addr="239.192.0.1"/&gt;
        &lt;/cman&gt;
        &lt;fencedevices&gt;
                &lt;fencedevice agent="fence_ipmilan" auth="password" ipaddr="192.168.1.1" login="test-user" name="ipmi-hostname1" passwd="test-password" delay="30"/&gt;
                &lt;fencedevice agent="fence_ipmilan" auth="password" ipaddr="192.168.1.2" login="test-user" name="ipmi-hostname2" passwd="test-password"/&gt;=
        &lt;/fencedevices&gt;
        &lt;rm&gt;
                &lt;failoverdomains&gt;
                        &lt;failoverdomain name="FailDomain" ordered="1" restricted="1"&gt;
                                &lt;failoverdomainnode name="hostname1.private" priority="1"/&gt;
                                &lt;failoverdomainnode name="hostname2.private" priority="2"/&gt;
                        &lt;/failoverdomain&gt;
                &lt;/failoverdomains&gt;
                &lt;resources&gt;
                &lt;/resources&gt;
                &lt;service autostart="1" domain="FailDomain" exclusive="0" name="servicel"&gt;
                &lt;/service&gt;
        &lt;/rm&gt;
&lt;/cluster&gt;

scp cluster.conf hostname1:/etc/cluster/cluster.conf

ccs_tool update cluster.conf
</code></pre>
<h3 id="configure-fencing">Configure fencing</h3>
<ul>
<li>Setup ipmi profile on the hardware </li>
<li>
<p>Test to see if fencing works</p>
<p>echo -e "ipaddr=192.168.1.1 \nlogin=<username> \npasswd=<password> \naction=status" | fence_ipmilan</p>
</li>
<li>
<p>Add the fencing details to the cluster.conf file
    <fencedevice agent="fence_ipmilan" auth="password" ipaddr="192.168.1.1" login="test-user" name="ipmi-hostname1" passwd="test-password" delay="30"/>
    <fencedevice agent="fence_ipmilan" auth="password" ipaddr="192.168.1.2" login="test-user" name="ipmi-hostname2" passwd="test-password"/></p>
<p>service rgmanager start
service cman start
clustat
cman_tool status
tail -f /var/log/messages</p>
</li>
<li>
<p>manual fence override
    fence_ack_manual -e -n hostname1.private</p>
</li>
<li>manaul service relocation
    clusvcadm -r ServiceName</li>
<li>
<p>ifconfig will not display a VIP you have to run</p>
<p>ip address show</p>
</li>
</ul>
<p>you may want to disable the acpi daemon otherwise your server may not switch off fast enough</p>
<pre><code>chkconfig --level 234 5 acpid off
chkconfig --levels 2345 cman off
chkconfig --levels 2345 rgmanager off
chkconfig --levels 2345 ricci off
chkconfig --levels 2345 luci off
</code></pre>
<h3 id="setup-ha-lvm">setup HA-LVM</h3>
<p><strong>...refer to section F.2. Configuring HA-LVM Failover with Tagging from RHEL 5 Cluster admin guide</strong></p>
<h3 id="edit-etclvmlvmconf">edit /etc/lvm/lvm.conf</h3>
<ol>
<li>
<p>Ensure that the locking_type parameter in the global section of the /etc/lvm/lvm.conf file is set to the value '1'.</p>
</li>
<li>
<p>Edit the volume_list field in the /etc/lvm/lvm.conf file. Include the name of your root volume group and your hostname as listed in the /etc/cluster/cluster.conf file preceded by @. The hostname to include here is the machine on which you are editing the lvm.conf file, not any remote hostname. Note that this string MUST match the node name given in the cluster.conf file. Below is a sample entry from the /etc/lvm/lvm.conf file:</p>
</li>
</ol>
<p>volume_list = [ "vgsys", "@hostname1.private" ]</p>
<h3 id="create-the-pv-vg-lv-and-filesystems-from-one-of-the-nodes">Create the PV VG LV and filesystems <strong>from one of the nodes</strong></h3>
<pre><code>pvcreate /dev/mapper/mpath1
pvcreate /dev/mapper/mpath2
pvcreate /dev/mapper/mpath3
pvcreate /dev/mapper/mpath4
pvcreate /dev/mapper/mpath5
pvcreate /dev/mapper/mpath6


vgcreate vg_shared_pc /dev/mapper/mpath1
vgcreate vg_shared_db /dev/mapper/mpath2
vgcreate vg_shared_arch /dev/mapper/mpath3
vgcreate vg_shared_logs /dev/mapper/mpath4
vgcreate vg_shared_data /dev/mapper/mpath5
vgcreate vg_shared_backup /dev/mapper/mpath6


lvcreate -l 100%FREE -n lv_shared_pc vg_shared_pc
lvcreate -l 100%FREE -n lv_shared_db vg_shared_db
lvcreate -l 100%FREE -n lv_shared_arch vg_shared_arch
lvcreate -l 100%FREE -n lv_shared_logs vg_shared_logs
lvcreate -l 100%FREE -n lv_shared_data vg_shared_data
lvcreate -l 100%FREE -n lv_shared_backup vg_shared_backup


mkfs.ext3 /dev/vg_shared_pc/lv_shared_pc
mkfs.ext3 /dev/vg_shared_db/lv_shared_db
mkfs.ext3 /dev/vg_shared_arch/lv_shared_arch
mkfs.ext3 /dev/vg_shared_logs/lv_shared_logs
mkfs.ext3 /dev/vg_shared_data/lv_shared_data
mkfs.ext3 /dev/vg_shared_backup/lv_shared_backup


mkdir /opt/pc
mkdir /opt/pc_db
mkdir /opt/pc_arch
mkdir /opt/pc_logs
mkdir /opt/pc_data
mkdir /opt/pc_backup
</code></pre>
              
            </div>
          </div>
          

<footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
      <!--  <a href="../HA_LVM_cluster_build_guide/" class="btn btn-neutral float-right" title="HA LVM cluster build guide"/>Next <span class="icon icon-circle-arrow-right"></span></a> -->
        <a href="../HA_LVM_cluster_build_guide/index.html" class="btn btn-neutral float-right" title="HA LVM cluster build guide">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
      <!-- <a href="../HA_LVM_automatic_failover_manual_fence_override/" class="btn btn-neutral" title="HA LVM automatic failover manual fence override"><span class="icon icon-circle-arrow-left"></span> Previous</a> -->
        <a href="../HA_LVM_automatic_failover_manual_fence_override/index.html" class="btn btn-neutral" title="HA LVM automatic failover manual fence override"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  <!-- Built with <a href="http://www.mkdocs.org">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. -->
</footer>
	  
        </div>
      </div>

    </section>

  </div>

<div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
      
        <span><a href="../HA_LVM_automatic_failover_manual_fence_override/" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../HA_LVM_cluster_build_guide/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>

</body>
</html>
