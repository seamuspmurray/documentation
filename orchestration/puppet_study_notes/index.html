<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><link rel="canonical" href="https://docs.seamusmurray.com/orchestration/puppet_study_notes/" />
      <link rel="shortcut icon" href="../../img/favicon.ico" />
    <title>Puppet study notes - Seamus Murray's Notes about Linux and System Engineering</title>
    <link rel="stylesheet" href="../../css/theme.css" />
    <link rel="stylesheet" href="../../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "Puppet study notes";
        var mkdocs_page_input_path = "orchestration/puppet_study_notes.md";
        var mkdocs_page_url = "/orchestration/puppet_study_notes/";
      </script>
    
    <!--[if lt IE 9]>
      <script src="../../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
      <script>hljs.highlightAll();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../.." class="icon icon-home"> Seamus Murray's Notes about Linux and System Engineering
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../..">Home</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">Linux</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="#">Clustering</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../../linux/Clustering/HA_LVM_automatic_failover/">HA LVM automatic failover</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../linux/Clustering/HA_LVM_automatic_failover_manual_fence_override/">HA LVM automatic failover manual fence override</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../linux/Clustering/HA_LVM_cluster_build/">HA LVM cluster build</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../linux/Clustering/HA_LVM_cluster_build_guide/">HA LVM cluster build guide</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../linux/Clustering/HA_LVM_manual_failover.txt/">HA LVM manual failover.txt</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../linux/Clustering/RHEL4_cluster_installation/">RHEL4 cluster installation</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../linux/Clustering/homemade_cluster/">Homemade cluster</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../linux/Clustering/simple.cluster.conf/">Simple.cluster.conf</a>
                </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="#">Commands</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../../linux/Commands/email_on_linux/">change mail relay for postfix</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../linux/Commands/hot_add_memory/">Hot add memory</a>
                </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="#">Core Utils</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../../linux/Core_Utils/awk/">Awk</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../linux/Core_Utils/bash_shortcuts/">Bash shortcuts</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../linux/Core_Utils/diff_and_cut_to_compare_part_of-lines_in_log_files/">Diff and cut to compare part of lines in log files</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../linux/Core_Utils/linux_proccess_signaling/">Linux proccess signaling</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../linux/Core_Utils/rename/">Rename</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../linux/Core_Utils/spacecmd_breaking_up_large_groups_of_hosts_with_awk/">Spacecmd breaking up large groups of hosts with awk</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../linux/Core_Utils/user_creation/">User creation</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../linux/Core_Utils/vim_sudo/">Vim sudo</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../linux/Core_Utils/watch_and_timeout/">Watch and timeout</a>
                </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="#">Disks and File Systems</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../../linux/Disks_and_File_Systems/Extend_lvm_filesystem/">Extend lvm filesystem</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../linux/Disks_and_File_Systems/Linux_LVM_Logical_Volume_Manager/">Linux LVM Logical Volume Manager</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../linux/Disks_and_File_Systems/Listing_Oracle_ASM_disks/">Listing Oracle ASM disks</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../linux/Disks_and_File_Systems/Multipath_and_NetApp_fixes/">Multipath and NetApp fixes</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../linux/Disks_and_File_Systems/Online_lun_resize/">Online lun resize</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../linux/Disks_and_File_Systems/RHEL_floppy_kickstart/">RHEL floppy kickstart</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../linux/Disks_and_File_Systems/boot_cdrom_dvdrom/">Boot cdrom dvdrom</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../linux/Disks_and_File_Systems/disk_filesystem_partition_imaging_using_squashfs_and_dd/">Disk filesystem partition imaging using squashfs and dd</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../linux/Disks_and_File_Systems/filesystem_shuffle/">Filesystem shuffle</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../linux/Disks_and_File_Systems/rsync/">Rsync</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../linux/Disks_and_File_Systems/shrink_lvm_filesystem/">Shrinking a Linux filesystem on LVM</a>
                </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="#">Firewalls and Security</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../../linux/Firewalls_and_Security/auditd_rules/">Auditd rules</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../linux/Firewalls_and_Security/iptables_notes/">My notes on IPtables</a>
                </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="#">Monitoring</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../../linux/Monitoring/nagios_2.6_install/">Nagios 2.6 install</a>
                </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="#">Networking</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../../linux/Networking/check_dns_records/">Check dns records</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../linux/Networking/determine_the_routes_a_packet_will_take/">Determine the routes a packet will take</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../linux/Networking/linux_networking/">Linux networking</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../linux/Networking/local_IP_address_survey/">local IP address survey</a>
                </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="#">RedHat</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../../linux/RedHat/kickstart/">Kickstart</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="#">Satellite spacewalk</a>
    <ul>
                <li class="toctree-l3"><a class="reference internal" href="../../linux/RedHat/satellite_spacewalk/perl_script_to_calulate_uptime_of_satellite_clients/">Perl script to calulate uptime of satellite clients</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../linux/RedHat/satellite_spacewalk/replacing_your_satellite_certificate/">Replacing your satellite certificate</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../linux/RedHat/satellite_spacewalk/satellite_certificate_licence_install/">Satellite certificate licence install</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../linux/RedHat/satellite_spacewalk/using_spacecmd/">Using spacecmd</a>
                </li>
    </ul>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="#">Yum rpm</a>
    <ul>
                <li class="toctree-l3"><a class="reference internal" href="../../linux/RedHat/yum_rpm/create_local_repos_from_redhat_install_media/">Create local repos from redhat install media</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../linux/RedHat/yum_rpm/working_with_yum_and_rpm/">Working with yum and rpm</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../linux/RedHat/yum_rpm/yum_and_rpm/">Yum and rpm</a>
                </li>
    </ul>
                </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="#">Software Packaging</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../../linux/Software_Packaging/apt_get/">Apt get</a>
                </li>
    </ul>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Orchestration</span></p>
              <ul class="current">
                  <li class="toctree-l1 current"><a class="reference internal current" href="./">Puppet study notes</a>
    <ul class="current">
    </ul>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Programming</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="#">C Programming</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../../programming/C_Programming/fork_and_maloc_demo/">Fork and maloc demo</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../programming/C_Programming/fork_demo_menu/">Fork demo menu</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../programming/C_Programming/linux_clocksource_benchmark/">Linux clocksource benchmark</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../programming/C_Programming/programmable_keyboard/">Programmable keyboard</a>
                </li>
    </ul>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Scripting</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../scripting/IP_survey/">IP survey</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../scripting/bash_and_grep_script_to_compare_2_lists/">Bash and grep script to compare 2 lists</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../scripting/bash_argument_shift_until_loop/">Bash argument shift until loop</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../scripting/bash_argument_shift_while_loop/">Bash argument shift while loop</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../scripting/bash_arguments/">Bash arguments</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../scripting/bash_array/">Bash array</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../scripting/bash_capture_keyboard_entry/">Bash capture keyboard entry</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../scripting/bash_case/">Bash case</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../scripting/bash_column_tally/">Bash column tally</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../scripting/bash_convert_kilobytes_to_MB_GB_TB_PB/">bash convert kilobytes to MB GB TB PB</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../scripting/bash_fail_and_exit/">Bash fail and exit</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../scripting/bash_fail_trap/">Bash fail trap</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../scripting/bash_function/">Bash function</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../scripting/bash_functions/">Bash functions</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../scripting/bash_local_vs_global_variables/">Bash local vs global variables</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../scripting/bash_nested_if_else/">Bash nested if else</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../scripting/bash_read_input/">Bash read input</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../scripting/bash_scripting/">Bash scripting</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../scripting/bash_select/">Bash select</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../scripting/bash_string_comparison/">Bash string comparison</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../scripting/bash_test_to_only_run_as_root/">Bash test to only run as root</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../scripting/bash_tips/">Bash tips</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../scripting/bash_trap_user_ctrl-c/">Bash trap user ctrl c</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../scripting/bash_use_a_file_to_control_script_operation/">Bash use a file to control script operation</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../scripting/bash_validate_DNS_entries/">bash validate DNS entries</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../scripting/bash_wait_for_user_input/">Bash wait for user input</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../scripting/expect/">Expect</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../scripting/script_to_markdown/">Script to markdown</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../scripting/simulate_site_failure/">Simulate site failure</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Timing</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../timing/Clock_Sources_and_System_Time/">Clock Sources and System Time</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../timing/Clock_Synchronization_and_NTP/">Clock Synchronization and NTP</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../timing/GetTimeOfDay/">GetTimeOfDay</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../timing/Latency_and_Jitter/">Latency and Jitter</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../timing/Linux_clocksource_benchmark/">Linux clocksource benchmark</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../timing/NTP_Authentication/">NTP Authentication</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../timing/Setting_time_like_it_is_1989/">Setting time like it is 1989</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../timing/System_Timing_and_Virtulalization/">System Timing and Virtulalization</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../..">Seamus Murray's Notes about Linux and System Engineering</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../.." class="icon icon-home" aria-label="Docs"></a></li>
          <li class="breadcrumb-item">Orchestration</li>
      <li class="breadcrumb-item active">Puppet study notes</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <p>Seamus Murray's Puppet study notes as of January 2015 </p>
<h3 id="puppetlabs-own-documentation-httpspuppetlabscomlearn">PuppetLabs own documentation https://puppetlabs.com/learn</h3>
<p>Sign up to the PuppetLabs learning portal https://puppetlabs.com/learn</p>
<p>2) go through the puppetlabs videos and questionnaires, it will give you an idea of the language used in the tests
   https://puppetlabs.com/learn/library</p>
<p>some of the videos seem to be based on lessons that can be found elsewhere of the puppet website (sorry I cant find them now )</p>
<p>3) puppetlabs provides a vm with puppet enterprise installed, 
   inside the zip file there is a pdf with a series of exercises
   http://puppetlabs.com/download-learning-vm</p>
<p>4) puppet practice exam</p>
<p>https://docs.puppetlabs.com/references/glossary.html</p>
<p>6) glossary of the key puppet terminology</p>
<p>https://puppetlabs.com/services/certification/puppet-professional-practice-exam</p>
<p></br></br></br></br></br></br>
</br></br></br></br></br></br></p>
<hr />
<h2 id="puppet-installation">Puppet installation</h2>
<h3 id="system-requirements">System requirements</h3>
<p>Puppet Enterprise 3.7 supports the following systems:</p>
<pre><code>+------------------+---------------------------+-------------+------------------------------------+
|Operating system  |Version(s)                 | Arch        |Component(s)                        |
|------------------|---------------------------|-------------|------------------------------------|
|RHEL              |4, 5, 6, 7                 |x86_64       |all (RHEL 4 supports agent only)    |
|CentOS            |4, 5, 6, 7                 |x86 &amp; x86_64 |all (CentOS 4 supports agent only)  |
|Ubuntu LTS        |10.04, 12.04, 14.04        |i386 &amp; amd64 |all                                 |
|Debian            |Squeeze (6), Wheezy (7)    |i386 &amp; amd64 |all                                 |
|Oracle Linux      |4, 5, 6, 7                 |x86 &amp; x86_64 |all (Oracle Linux 4 agent only)     |
|Scientific Linux  |4, 5, 6                    |x86 &amp; x86_64 |all (Scientific Linux 4 agent only) |
|SUSE Enterprise   |10 (SP4 only), 11(SP1), 12 |x86 &amp; x86_64 |all (SLES 10 supports agent only)   |
|Solaris           |10 (Update 9 or later) 11  |SPARC &amp; i386 |agent                               |
|Microsoft Windows |2008 2008R2 7 Ultimate SP1 |x86 &amp; x64    |agent                               |
|                  |8 Pro, 8.1 Pro 2012 2012R2 |x86 &amp; x64    |agent                               |
|Microsoft Windows |2003, 2003R2               |x86          |agent                               |
|AIX               |5.3, 6.1, 7.1              |Power        |agent                               |
|Mac OS X          |Mavericks (10.9)           |x86_64       |agent                               |
+------------------+---------------------------+-------------+------------------------------------+
</code></pre>
<p>https://docs.puppetlabs.com/pe/latest/install_basic.html#about-puppet-enterprise-components
   the puppet enterprise  3.1 guide refers to  puppet master role  database support role console role</p>
<p><strong>Monolithic (all-in-one) Installation</strong></p>
<p>Monolithic installs are suitable for deployments up to 500 nodes. We recommend that your hardware meets the following:</p>
<ul>
<li>The puppet master, PE console, and PuppetDB node: at least 4-8 processor cores, 8 GB RAM</li>
<li>All machines require very accurate timekeeping</li>
<li>Puppet agent nodes: any hardware able to run the supported operating system</li>
<li>For /var/, at least 1 GB of free space for each PE component on a given node</li>
<li>For PE-installed PostgreSQL, at least 100 GB of free space in /opt/ for data gathering</li>
<li>For no PE-installed PostgreSQL, /opt/ needs at least 1 GB of disk space available</li>
</ul>
<p><strong>Split Installation</strong></p>
<p>For larger deployments (500-1000, or more nodes), we recommend a split install. We recommend that your hardware meets the following:</p>
<ul>
<li>Puppet master, PE console, and PuppetDB nodes: at least 8 processor cores, 8 GB RAM (per node)</li>
<li>All machines require very accurate timekeeping</li>
<li>Puppet agent nodes: any hardware able to run the supported operating system</li>
<li>For /var/, at least 1 GB of free space for each PE component on a given node</li>
<li>For PE-installed PostgreSQL, at least 100 GB of free space in /opt/ for data gathering</li>
<li>For no PE-installed PostgreSQL, /opt/ needs at least 1 GB of disk space available</li>
</ul>
<h3 id="firewall-configuration">Firewall Configuration</h3>
<p>Agent nodes contact the puppet master server on TCP ports 8140 (for Puppet) and 61613 (for orchestration).
Any hosts that need access to the html GUI will contact the  console server on port 443(can be changed to a different port).</p>
<pre><code>+-----------------+---------+---------+---------+----------+
|                 |  AGENT  | MASTER  | CONSOLE | ADMIN PC |
|-----------------|---------|---------|---------|----------|
|puppet           |   ----&gt; |   8140  |         |          |
|Orchestration    | 61613--&gt;|&lt;--61613 |         |          |
|HTML GUI         |         |         |   443   | &lt;----    |
|Master Installer |         |   3000  |         | &lt;----    | #html installer
+-----------------+---------+---------+---------+----------+
</code></pre>
<p>From 3.1 installation guide... https://docs.puppetlabs.com/pe/3.1/install_system_requirements.html</p>
<h3 id="hardware-requirements-for-the-various-puppet-rolescomponents">Hardware requirements for the various puppet roles/components</h3>
<p>Puppet Enterprise’s hardware requirements depend on the roles a machine performs.</p>
<ul>
<li>
<p>The <strong>puppet master role</strong> should be installed on a robust, dedicated server.
        Minimum requirements: 2 processor cores, 1 GB RAM, and very accurate timekeeping.
        Recommended requirements: 2-4 processor cores, at least 4 GB RAM, and very accurate timekeeping.
        Performance will vary, but this configuration can generally manage approximately 1,000 agent nodes.</p>
</li>
<li>
<p>The <strong>database support role</strong> can be installed on the same server as the console or, optionally, on a separate, dedicated server.
        Minimum requirements: These will vary considerably depending on the size of your deployment. 
        However, you’ll need a machine able to handle moderate network traffic, perform processor-intensive background tasks, and run a disk-intensive PostgreSQL database server.
        The machine should have two to four processor cores.
        As a rough rule of thumb for RAM needed, start here: 1-500 nodes: 192-1024MB, 500-1000 nodes: 1-2GB, 1000-2000 nodes: 2-4 GB, 2000+ nodes, 4GB or greater.
        So as your deployment scales, make sure to scale RAM allocations accordingly.
        More information about scaling PuppetDB is available in the PuppetDB manual’s scaling guidelines.</p>
</li>
<li>
<p>The <strong>console role</strong> should usually be installed on a separate server from the puppet master, but can optionally be installed on the same server in smaller deployments.
        Minimum requirements: A machine able to handle moderate network traffic and perform processor-intensive background tasks.
        It should have a very fast network connection to the database support server, which it uses for all of the console’s database requirements.
        Requirements will vary significantly depending on the size and complexity of your site.</p>
</li>
<li>
<p>The optional <strong>cloud provisioner role</strong> has very modest requirements.
        Minimum requirements: A system which provides interactive shell access for trusted users.
        This system should be kept very secure, as the cloud provisioning tools must be given cloud service account credentials in order to function.</p>
</li>
<li>
<p>The puppet <strong>agent role</strong> has very modest requirements.
        Minimum requirements: Any hardware able to comfortably run a supported operating system.</p>
</li>
</ul>
<h2 id="install-script">Install script</h2>
<p>[root@master puppet-enterprise-3.7.1-el-6-x86_64]# ./puppet-enterprise-installer -h</p>
<p>Puppet Enterprise v3.7.1 installer</p>
<p>Puppet Enterprise documentation can be found at http://docs.puppetlabs.com/pe/3.7/</p>
<p>USAGE: puppet-enterprise-installer [-a ANSWER_FILE] [-A ANSWER_FILE] [-D] [-h] [-l LOG_FILE] [-n] [-q] [-s ANSWER_FILE] [-V]</p>
<p>OPTIONS:</p>
<ul>
<li><strong>-a ANSWER_FILE</strong> - Read answers from file and quit with error if an answer is missing.</li>
<li><strong>-A ANSWER_FILE</strong> - Read answers from file and prompt for input if an answer is missing.</li>
<li><strong>-D</strong>             - Display debugging information.</li>
<li><strong>-h</strong>             - Display this help.</li>
<li><strong>-l LOG_FILE</strong>    - Log commands and results to file.</li>
<li><strong>-n</strong>             - Run in 'noop' mode; show commands that would have been run during installation without running them</li>
<li><strong>-q</strong>             - Run in quiet mode; the installation process is not displayed. Requires answer file.</li>
<li><strong>-s ANSWER_FILE</strong> - Save answers to file and quit without installing.</li>
<li><strong>-V</strong>             - Display very verbose debugging information.</li>
</ul>
<h3 id="install-the-pe-agent">Install the pe-agent</h3>
<pre><code>curl -k https://&lt;puppet master server&gt;:8140/packages/current/install.bash | sudo bash
</code></pre>
<h3 id="puppetconf">puppet.conf</h3>
<p>/etc/puppetlabs/puppet/puppet.conf  {puppet enterprise}
or
/etc/puppet/puppet.conf  {puppet opensource}</p>
<pre><code>[main]
    certname = learning.puppetlabs.vm
    vardir = /var/opt/lib/pe-puppet
    logdir = /var/log/pe-puppet
    rundir = /var/run/pe-puppet
    basemodulepath = /etc/puppetlabs/puppet/modules:/opt/puppet/share/puppet/modules
    environmentpath = /etc/puppetlabs/puppet/environments
    server = learning.puppetlabs.vm
    user  = pe-puppet
    group = pe-puppet
    archive_files = true
    archive_file_server = learning.puppetlabs.vm
    module_groups = base+pe_only

[agent]
    report = true
    classfile = $vardir/classes.txt
    localconfig = $vardir/localconfig
    graph = true
    pluginsync = true
    environment = production
</code></pre>
<h3 id="ssl-certificates-and-accurate-time">SSL certificates and accurate time</h3>
<p>If there is a clock sync issue between an agent and the master you will receive certificate verification errors..</p>
<p>root@node3:~# puppet agent -t
Warning: Unable to fetch my node definition, but the agent run will continue:
Warning: SSL_connect returned=1 errno=0 state=SSLv3 read server certificate B: certificate verify failed: [CRL is not yet valid for /CN=master.puppetlabs]
 Info: Retrieving plugin
Error: /File[/var/lib/puppet/lib]: Failed to generate additional resources using 'eval_generate': SSL_connect returned=1 errno=0 state=SSLv3 read server certificate B: certificate verify failed: [CRL is not yet valid for /CN=master.puppetlabs]
Error: /File[/var/lib/puppet/lib]: Could not evaluate: SSL_connect returned=1 errno=0 state=SSLv3 read server certificate B: certificate verify failed: [CRL is not yet valid for /CN=master.puppetlabs] Could not retrieve file metadata for puppet://puppet/plugins: SSL_connect returned=1 errno=0 state=SSLv3 read server certificate B: certificate verify failed: [CRL is not yet valid for /CN=master.puppetlabs]
Error: Could not retrieve catalog from remote server: SSL_connect returned=1 errno=0 state=SSLv3 read server certificate B: certificate verify failed: [CRL is not yet valid for /CN=master.puppetlabs]
Warning: Not using cache on failed catalog
 Error: Could not retrieve catalog; skipping run
Error: Could not send report: SSL_connect returned=1 errno=0 state=SSLv3 read server certificate B: certificate verify failed: [CRL is not yet valid for /CN=master.puppetlabs]</p>
<p>resolution sync the clock's and restart puppet agent service or manually run puppet agent -t</p>
<h3 id="resetting-a-nodes-certificate">Resetting a nodes certificate</h3>
<pre><code>+--------------------------------+-----------------------------+
|       PUPPET AGENT             |    PUPPET MASTER            |
|--------------------------------|-----------------------------|
|  service puppet stop           |                             |
|  puppet config print ssldir    |                             |
|  rm -rf  /var/lib/puppet/ssl   |                             |
|                                | puppet cert list --all      |
|                                | puppet cert clean &lt;certname&gt;|
|  puppet agent -t               |                             |
|                                | puppet cert list            |
|                                | puppet sign &lt;certname&gt;      |
|  puppet agent -t               |                             |
|  service puppet start          |                             |
+--------------------------------+-----------------------------+
</code></pre>
<p>Until the puppet master signs the nodes cert the agent will display the following message</p>
<pre><code>root@node3:~# puppet agent -t
Exiting; no certificate found and waitforcert is disabled
</code></pre>
<h3 id="puppet-cert-command-line-options">Puppet Cert command line options</h3>
<pre><code>puppet cert  &lt;action&gt;  &lt;host&gt;
</code></pre>
<ul>
<li>
<p><strong>clean:</strong>
  Revoke a host's certificate (if applicable) and remove all files
  related to that host from puppet cert's storage. This is useful when
  rebuilding hosts, since new certificate signing requests will only be
  honored if puppet cert does not have a copy of a signed certificate
  for that host. If '--all' is specified then all host certificates,
  both signed and unsigned, will be removed.</p>
</li>
<li>
<p><strong>fingerprint:</strong>
  Print the DIGEST (defaults to the signing algorithm) fingerprint of a
  host's certificate.</p>
</li>
<li>
<p><strong>generate:</strong>
  Generate a certificate for a named client. A certificate/keypair will
  be generated for each client named on the command line.</p>
</li>
<li>
<p><strong>list:</strong>
  List outstanding certificate requests. If '--all' is specified, signed
  certificates are also listed, prefixed by '+', and revoked or invalid
  certificates are prefixed by '-' (the verification outcome is printed
  in parenthesis).</p>
</li>
<li>
<p><strong>print:</strong>
  Print the full-text version of a host's certificate.</p>
</li>
<li>
<p><strong>revoke:</strong>
  Revoke the certificate of a client. The certificate can be specified either
  by its serial number (given as a hexadecimal number prefixed by '0x') or by its
  hostname. The certificate is revoked by adding it to the Certificate Revocation
  List given by the 'cacrl' configuration option. Note that the puppet master
  needs to be restarted after revoking certificates.</p>
</li>
<li>
<p><strong>sign:</strong>
  Sign an outstanding certificate request.</p>
</li>
<li>
<p><strong>verify:</strong>
  Verify the named certificate against the local CA certificate.</p>
</li>
<li>
<p><strong>reinventory:</strong>
  Build an inventory of the issued certificates. This will destroy the current
  inventory file specified by 'cert_inventory' and recreate it from the
  certificates found in the 'certdir'. Ensure the puppet master is stopped
  before running this action.</p>
</li>
</ul>
<hr />
<p></br></br></br></br></br></br></p>
<h2 id="node-classification-sitepp-enc">Node Classification  site.pp ENC</h2>
<h3 id="certname">Certname</h3>
<p>By default each nodes certification name is its FQDN.
When the puppet agent on the nodes request at catalogue from the puppet master it does so using its current FQDN {even if they had already generated a certificate and had it signed by the master}. Therefore if the nodes host or domain name changes it will make a request based on the new name and you will have to sign a new cert on the master.</p>
<h3 id="classification-of-nodes">Classification of nodes</h3>
<p>In puppet the term classification  refers to the linking/assigning of classes to nodes. This can be achieved in many ways</p>
<p>** Using site.pp **</p>
<pre><code>node '&lt;group name&gt;' {
  include &lt;class&gt;
}

node '&lt;node name&gt;' {
  include &lt;class&gt;
}
</code></pre>
<p>** Using the puppet enterprise console**</p>
<ol>
<li>Click on Classification in the console navigation bar.
    ( Optional steps to create a new group )<ol>
<li>Enter a new node group name</li>
<li>click Add group</li>
</ol>
</li>
<li>Click on the desired group and set the rules for this group based on facter values name/osfamily etc... click add rule</li>
<li>Click commit change</li>
</ol>
<p>If your changes to the site.pp manifest are'nt reflected in a puppet run triggered by the puppet agent -t command, try running the command again.</p>
<p>** Using an ENC External node Classifier **
An executable that can be called by puppet master; it doesn’t have to be written in Ruby. Its only argument is the name of the node to be classified, and it returns a YAML document describing the node.</p>
<p>Node statements are an <strong>optional feature</strong> of Puppet. They can be replaced by or combined with an external node classifier. You can also use conditional statements upon facts to classify nodes.</p>
<hr />
<p></br></br></br></br></br></br></p>
<h2 id="sitepp-syntax">site.pp syntax</h2>
<h3 id="the-default-node">The Default Node</h3>
<p>The site.pp file has an optional default node declaration . It follows the same format as a normal node declaration except the word  default <strong>(without quotes)</strong> is used  in place of a cert/host name. If a node requests a catalogue and there is no matching cert/host name in the site.pp then the node will be assigned what ever settings have be set for the default node.</p>
<p>You can simply use the <strong>node name</strong>:</p>
<pre><code>node 'www.example.com' {
  include common
  include apache, squid
}
</code></pre>
<p>You can use a <strong>comma-separated list</strong> of names to create a group of nodes with a single node statement:</p>
<pre><code>node 'www1.example.com', 'www2.example.com', 'www3.example.com' {
  include common
  include apache, squid
}
</code></pre>
<p>You can use <strong>Regular expressions</strong> (regexes) can be used as node names. In puppet regexes must be surrounded by forward slashes /</p>
<p>match any node with the name www followed by 1 or more digits (www1 , www12345)</p>
<pre><code>node /^www\d+$/ {
  include common
}
</code></pre>
<p>match foo.example.com and bar.example.com</p>
<pre><code>node /^(foo|bar)\.example\.com$/ {
  include common
}
</code></pre>
<p>If site.pp contains at least one node definition, it must have one for every node; compilation for a node will fail if one cannot be found. (Hence the usefulness of the default node.) If site.pp contains no node definitions, this requirement is dropped.</p>
<p><strong>Matching</strong></p>
<p>If a nodes certname/hostname is matched by more than one node statement it will only get the contents of one node definition.
Puppet will do the following checks in order when deciding which definition to use:</p>
<ol>
<li>If there is a node definition with the node’s exact name, Puppet will use it.</li>
<li>If there is a regular expression node statement that matches the node’s name, Puppet will use it. (If more than one regex node matches, Puppet will use one of them, with no guarantee as to which.)</li>
<li>If the node’s name looks like a fully qualified domain name (i.e. multiple period-separated groups of letters, numbers, underscores and dashes), Puppet will chop off the final group and start again at step 1. (That is, if a definition for www01.example.com isn’t found, Puppet will look for a definition matching www01.example.)</li>
<li>Puppet will use the default node.</li>
</ol>
<p>Thus, for the node www1.example.com, Puppet would try the following, in order:</p>
<pre><code>www1.example.com
A regex that matches www1.example.com
www1.example
A regex that matches www1.example
www1
A regex that matches www1
default
</code></pre>
<p>In my testing with a site.pp</p>
<pre><code>node 'node2.puppetlabs' {
  include hosts
}

node /^node(2|4)/ {
  include regexmod
  include definedmod
  include ntp
}
</code></pre>
<p>with the node/cert name of node2.puppetlabs it is matched my the most accurate name ie "node2.puppetlabs"</p>
<p>if the site.pp only has the shortname and a shortname+regex then the regex its matched</p>
<p>eg..</p>
<pre><code>node 'node2' {
  include hosts
}

node /^node(2|4)/ {
  include regexmod
  include definedmod
  include ntp
}
</code></pre>
<h3 id="merging-sitepp-with-enc-data">Merging site.pp With ENC Data</h3>
<p>Node definitions and external node classifiers can co-exist. Puppet merges their data as follows:</p>
<p>Variables from an ENC are set at top scope and can thus be overridden by variables in a node definition.
Classes from an ENC are declared at node scope, which means they will be affected by any variables set in the node definition.</p>
<p>Although both will work together it is recommend to use  <strong>either</strong> node definitions or an ENC.</p>
<p>External nodes override node configuration in the manifest files. If you enable an external node classifier, any duplicate node definitions in your manifest files will not be processed; they will be ignored by Puppet.</p>
<p>The use of LDAP nodes overrides node definitions in your manifest files and your ENC. If you use LDAP node definitions, you cannot define nodes in your manifest files or in an ENC.</p>
<p>Inheritance</p>
<p>In earlier versions of Puppet, nodes could inherit from other nodes using the inherits keyword. This feature is deprecated in Puppet 3.7,</p>
<h2 id="node-classification-in-puppet-enterprise-console">node classification in puppet enterprise console</h2>
<p>click the <strong>classification</strong> tab
select the group or create a new group
set the rules to match the node</p>
<ul>
<li><strong>static matching</strong>, add the nodes FQDN in the certname field and pin the node to the group </li>
<li><strong>dynamic matching</strong>, create a <strong>fact + operator + value</strong> based rule to match the node, e.g.</li>
</ul>
<p>Table detailing possible matching rules</p>
<pre><code>+-----------+----------------+------------------------+
|  FACT     | OPERATOR       |  VALUE or REGEX        |
+-----------+----------------+------------------------+
|  hostname |  is            |  pe-node2              |
|  name     |  is            |  pe-node3.puppetlabs   |
|  name     |  matches regex |  pe-node\d.puppetlabs  |
|  name     |  matches regex |  node(4|5).puppetlabs  |
|  osfamily |  is            |  RedHat                |
+-----------+----------------+------------------------+
</code></pre>
<p><strong>Note</strong> Don't forget to click <strong>add Rule</strong> and then click <strong>commit x change</strong></p>
<h3 id="default-node-group">default node group</h3>
<p>PE comes preconfigured with the <strong>default node group</strong>.
This is the root of the node group hierarchy and is a parent to all other node groups. 
The classes that are assigned to the default node group are applied to all of the nodes in your deployment. </p>
<h2 id="deleting-nodes-from-puppet-enterprise-console">Deleting Nodes from puppet enterprise console</h2>
<p>There are three options for deleting a node:</p>
<ol>
<li>
<h3 id="hide-node">Hide Node</h3>
Removes the node from the node list view. To hide a node:<pre><code>On the Nodes page, click the node.
Click Hide.
</code></pre>
</li>
<li>
<h3 id="delete-node">Delete Node</h3>
<p>Removes all reports and information for the node from the console. The node no longer appears in the list of nodes on the Nodes page, but it continues to appear in Matching nodes until it is purged from PuppetDB. The node will reappear as a new node on the Nodes page if it submits a new Puppet run report. To delete a node:</p>
<pre><code>On the Nodes page, click the node.
Click Delete.
</code></pre>
</li>
<li>
<h3 id="deactivate-node">Deactivate Node</h3>
<p>Completely deactivates the node and frees up the license assigned to the node. Any deactivated node will be reactivated if PuppetDB receives new catalogues or facts for it. For details, see Deactivating a PE agent node. </p>
<ol>
<li>
<p>Stop the agent service on the node you want to deactivate.</p>
</li>
<li>
<p>On the Puppet master, deactivate the agent; run <strong>puppet node deactivate {NODE NAME}</strong>.
 This deactivates the agent in PuppetDB. In some cases, the PE license count in the console will not decrease for up to 24 hours, but you can restart the pe-memcached service to update the license count sooner.</p>
</li>
<li>
<p>On the Puppet master, revoke the agent certificate; run <strong>puppet cert revoke {AGENT CERTNAME}</strong>.</p>
</li>
<li>
<p>Still on the Puppet master, <strong>run puppet agent -t</strong> to kick off a Puppet run.
 This Puppet run will copy the certificate revocation list (CRL) to the correct SSL directory for delivery to the agent.</p>
</li>
<li>
<p>Restart the Puppet master with <strong>service pe-puppetserver restart</strong>.
 The certificate is only revoked after running service pe-puppetserver restart. In addition, the Puppet server process won’t re-read the certificate revocation list until the service is restarted. If you don’t run service pe-puppetserver restart, the node will check in again on the next Puppet run and re-register with PuppetDB, which will increment the license count again.</p>
</li>
<li>
<p>Delete the node from the console. In the console, click Nodes. Click the node that you want to delete and click the Delete button.
 This action does NOT disable MCollective/live management on the node.</p>
</li>
<li>
<p>To disable MCollective/live management on the node, uninstall the Puppet agent, stop the pe-mcollective service (on the agent, run service pe-mcollective stop), or destroy the agent altogether.
 On the agent, remove the node certificates in <strong>/etc/puppetlabs/mcollective/ssl/clients</strong>.</p>
</li>
<li>
<p>clean the cert from the pauppet master ...<strong>puppet cert clean  {AGENT CERTNAME}</strong></p>
</li>
</ol>
<blockquote>
<blockquote>
<p>Note: If you delete a node from the node view without first deactivating the node, the node will be absent from the node list in the console, but the license count will not decrease, and on the next Puppet run, the node will be listed in the console.</p>
</blockquote>
</blockquote>
</li>
</ol>
<p>At this point, the node should be fully deactivated.</p>
<hr />
<p></br></br></br></br></br></br></p>
<h2 id="regex-in-puppet">Regex in puppet</h2>
<p>Regexes in Puppet cannot have options or encodings appended after the final slash.
However, you may turn options on or off for portions of the expression using the (?<ENABLED OPTION>:<SUBPATTERN>) and (?-<DISABLED OPTION>:<SUBPATTERN>) notation.
The following example enables the <strong>i</strong> option while disabling the <strong>m</strong> and <strong>x</strong> options:</p>
<pre><code> $packages = $operatingsystem ? {
   /(?i-mx:ubuntu|debian)/        =&gt; 'apache2',
   /(?i-mx:centos|fedora|redhat)/ =&gt; 'httpd',
 }
</code></pre>
<p>The following options are allowed:</p>
<pre><code>i — Ignore case
m — Treat a newline as a character matched by .
x — Ignore white space and comments in the pattern
</code></pre>
<hr />
<p></br></br></br></br></br></br></p>
<h2 id="puppet-run-overview">Puppet run overview</h2>
<ul>
<li>The SSL checks are made first</li>
<li>The agent checks for a certificate matching its FQDN<ul>
<li>If one is not found the agent generates one. </li>
</ul>
</li>
<li>The agent checks for the CA cert.<ul>
<li>if not it will send its cert  to the CA servers and request for its cert to be signed.</li>
</ul>
</li>
<li>If plugin sync is enabled, the agent checks the master for new plugins and downloads them if necessary.</li>
<li>The agent ask's Facter for a set of facts about itself. { facter -p }</li>
<li>The agent sends the facts the master whilst requesting a catalog.</li>
<li>The master injects those facts as variables in the root scope and processes the manifests.</li>
<li>The master then sends the catalog to the agent.</li>
<li>The agent apply's the catalog.</li>
<li>If reporting is enabled the agent sends a report back to the master.</li>
</ul>
<p>Diagram of puppet run</p>
<pre><code>+-----------------------+     +-----------------------+
|        AGENT          |     |        MASTER         |
|  +-----------------+  |     |                       |
|  | Check local Cert|  |     |     +--------------+  |
|  | create if needed|  |     | +--&gt;| Send CA Cert |  |
|  +-----------------+  |     | |   +--------------+  |
| +------------------+  |     | |                     |
| | Check 4 copy of  |  |     | |                     |
| | CA Cert,retrieve |  |     | |                     |
| | if needed        |&lt;---------+                     |
| +------------------+  |     |                       |
| +-------------------+ |     |  +------------------+ |
| | Is my Cert signed |&lt;--------&gt;| Sign Client Cert | |
| +-------------------+ |     |  +------------------+ |
|                       |     |                       |
|  +-----------------+  |     |  +-----------------+  |
|  | Request plugins |---------&gt; |  Send Plugins   |  |
|  +-----------------+  |     |  +-----------------+  |
|                       |     |           |           |
|  +---------------- +  |     |           |           |
|  | Import plugins  |&lt;-------------------+           |
|  +-----------------+  |     |                       |
|                       |     |                       |
|  +-----------------+  |     |     +--------------+  |
|  |                 |  |     |     |   CLASSIFY   |  |
|  | REQUEST CATALOG +------------&gt; |The Node based|  |
|  |  Send node name |  |     |     |on certname + |  |
|  |  and facts to   |  |     |     | node groups  |  |
|  |  the master     |  |     |     +--------------+  |
|  |                 |  |     |     ______|______     |
|  ------------------+  |     |    |      |      |    |
|                       |     | +--V--++--V--++--V--+ |
|                       |     | |CLASS||CLASS||CLASS| |
|  +---------------+    |     | +-----++-----++-----+ |
|  |               |    |     |      \    |     /     |
|  |    CATALOG    | &lt;-----------+  +-V---V----V-+    |
|  |               |    |     |  |  |            |    |
|  +--------+------+    |     |  |  |  COMPILE   |    |
|           |           |     |  |  |            |    |
|  +--------V---------+ |     |  |  +------------+    |
|  |APPLY +--------+  | |     |  |        V           |
|  |      | QUERY  |  | |     |  |        |           |
|  |      | STATUS |  | |     |  +----&lt;---+           |
|  |      +----|---+  | |     |                       |
|  |    +------V----+ | |     |                       |
|  |    |  ENFORCE  | | |     |                       |
|  |    |  DEFINED  | | |     |                       |
|  |    |  STATE    | | |     |                       |
|  |    +-----------+ | |     |    +-------------+    |
|  +----+-------------+ |     |    |             |    |
|           |           |     |    |   REPORT    |    |
|           |--------------------&gt; |             |    |
|           |           |     |    +-------------+    |
|  +--------V---------+ |     |                       |
|  |  DEFINED SYSTEM  | |     |                       |
|  |      STATE       | |     |                       |
|  +------------------+ |     |                       |
+-----------------------+     +-----------------------+
</code></pre>
<hr />
<p></br></br></br></br></br></br></p>
<h2 id="resources-classes-manifest">Resources ---}  Classes   ---}  Manifest</h2>
<h3 id="manifests">Manifests</h3>
<p>A puppet manifest is text file that contains puppet code and is appended by the .pp file extension.</p>
<h3 id="catalog">Catalog</h3>
<p>In a standard agent + master puppet configuration, the agent never receives a copy of the modules, manifests, functions or variables.
The agent only receives the compiled catalogue of resources and relationships.</p>
<p>It is not recommended by puppetlabs, however you can send each node an entire copy of the manifests for the nodes the compile the catalog and apply it locally,
This may be desirable in situations where there is no direct network connectivity between the agent and master.
Warning: each node will be able to see the entire manifest which may contain sensitive information relating to other nodes in your environment.</p>
<h3 id="modules">Modules</h3>
<p>Modules are just directories and files with a predictable structure located in the module path.
The following commands will display the module path.</p>
<pre><code># puppet agent --configprint modulepath
# puppet config print modulepath
/etc/puppet/modules:/usr/share/puppet/modules
</code></pre>
<p>Modules will often have a main class that shares the name of the module.</p>
<pre><code>module-name
|-manifests/
|-files/
|-templates/
|-lib/
|-tests/
|-spec/
</code></pre>
<p>If a class is defined in a module you can then declare that class in any manifest by name.</p>
<p>Autoloading in Puppet means that your modules will be loaded by Puppet at compile time, as long as they follow a predictable structure.</p>
<pre><code>puppet _\   compile  _\   load
 run    /   catalog   /  modules
</code></pre>
<h3 id="example-modules">Example module's</h3>
<pre><code>tree /etc/puppetlabs/puppet/environments/production/modules/sshd

/etc/puppetlabs/puppet/environments/production/modules/sshd
├── files
│   └── sshd_config
├── manifests
│   └── init.pp
└── tests
    └── init.pp
</code></pre>
<p>example module with class includes</p>
<pre><code>cowsayings
├── manifests
│   ├── init.pp     -----&gt;   class cowsayings {
│   │                          include cowsayings::cowsay
│   │                          include cowsayings::fortune
│   │                        }
│   │
│   │
│   ├── cowsay.pp   -----&gt;   class cowsayings::cowsay {
│   │                          package { 'cowsay':
│   │                          ensure =&gt; 'present',
│   │                        }
│   │
│   │
│   └── fortune.pp  -----&gt;   class cowsayings::fortune {
│                                package { 'fortune-mod':
│                                  ensure =&gt; 'present',
│                                }
│                            }
│
└── tests
    │
    ├── init.pp    --&gt;   include cowsayings
    │
    │
    ├── cowsay.pp  --&gt;   include cowsayings::cowsay
    │
    │
    └── fortune.pp --&gt;   include cowsayings::fortune
</code></pre>
<h3 id="puppet-module-command-line">puppet module command line</h3>
<pre><code>#puppet module &lt;action&gt;
</code></pre>
<p>ACTIONS:</p>
<ul>
<li><strong>build</strong>    -    Build a module release package.</li>
<li><strong>changes</strong>  -    Show modified files of an installed module.</li>
<li><strong>generate</strong> -    Generate boilerplate for a new module.</li>
<li><strong>install</strong>   -   Install a module from the Puppet Forge or a release archive.</li>
<li><strong>list</strong>   -   List installed modules</li>
<li><strong>search</strong> -      Search the Puppet Forge for a module.</li>
<li><strong>uninstall</strong> -   Uninstall a puppet module.</li>
<li><strong>upgrade</strong> -    Upgrade a puppet module.</li>
</ul>
<p>When uploading a module to the forge your must include a ** modulefile ** containing the modules  metadata (name, version, source, author, description, etc.) </p>
<hr />
<p></br></br></br></br></br></br></p>
<h2 id="resources">Resources</h2>
<p>Each resource describes some aspect of a system and its state e.g....</p>
<ul>
<li>a service that must be running</li>
<li>a package that must be installed</li>
<li>a user that must be configured</li>
</ul>
<p>A resource declaration is the puppet block of code that describes a resource.
Resource declarations are written the in the puppet DML Declarative Modelling Language.</p>
<p>Puppet's DML is a declarative language rather than an imperative one. This means that instead of defining a process or set of commands, Puppet code describes (or declares) only the desired end state, and relies on built-in providers to deal with implementation.</p>
<p>Resource declaration syntax example</p>
<pre><code>type { 'title':
  attribute_1  =&gt;  value_1,
  attribute_2  =&gt;  value_2,
}
</code></pre>
<ul>
<li>type and title must be unique for a node</li>
<li>values must be alphanumeric (quote strings)</li>
<li>each attribute + value pair must be followed by a comma</li>
</ul>
<p>Individual resources are combined together to represent the desired system configuration.</p>
<p>Similar resources can be grouped into types.  such as the user type</p>
<h3 id="resource-abstraction-layer">Resource Abstraction Layer</h3>
<pre><code>    +---------------------------------------+
    | file | package | service  |  user     |  Resources
    |---------------------------------------|
    | Ruby | Apt     | Redhat   | Useradd   |  Providers
    |      | Yum     | Launchd  | LDAP      |
    |      | Gems    | SMF      | Netinfo   |
    |      | Deb     | Debian   |           |
    |      | RPM     |          |           |
    +---------------------------------------+
</code></pre>
<h3 id="query-a-resource-using-the-puppet-command-line-tool">Query a resource using the puppet command line tool</h3>
<pre><code>puppet resource &lt;type&gt; {display all the instances of the specified type}
puppet resource package
puppet resource host
puppet resource user 
puppet resource &lt;type&gt; &lt;title&gt; {display the details of a particular resources instance }
puppet resource package apache
puppet resource host example.com
puppet resource user seamus
puppet resource --type  {list all types}
puppet describe &lt;type&gt; {display a description of the type and its options}
</code></pre>
<h3 id="puppet-apply">Puppet Apply</h3>
<p>You can use the Puppet resource declaration syntax with the puppet apply tool to make quick changes to resources on the system.</p>
<p>You can either change the values directly from the command line using the syntax..</p>
<pre><code>puppet apply -e "user { 'seamus': ensure =&gt; 'present', }"
</code></pre>
<p>Or you can open the resource declaration in vim with the syntax...</p>
<pre><code>puppet apply -e user seamus
</code></pre>
<p>The resource will be opened in vim. Make any desired changed and when you quit vim the new resource values will be applied.</p>
<hr />
<p></br></br></br></br></br></br></p>
<h3 id="defined-resource-type-aka-defined-types-or-defines">Defined Resource Type (aka <strong>defined types</strong> or <strong>defines</strong>)</h3>
<p>are types that can be evaluated multiple times using different parameters during declaration. Upon each new declaration with new parameters they act like a new resource type. </p>
<p>Seamus sample module using defined resources
[root@master modules]# tree definedmod</p>
<pre><code>definedmod
├── manifests
│   ├── definedresource.pp
│   └── init.pp
└── tests
    └── init.pp
</code></pre>
<p>[root@master modules]# cat definedmod/manifests/init.pp</p>
<pre><code>class definedmod {
  definedresource {'mydefinedresource':
         var2 =&gt; 'twovar',
         var1 =&gt; 'variable1',
         var3 =&gt; 'thirdvariable',
  }
}
</code></pre>
<p>[root@master modules]# cat definedmod/manifests/definedresource.pp</p>
<pre><code>define definedresource ($var1, $var2 = default2 , $var3 = default3) {

  file { "/tmp/${var1}" :
    ensure  =&gt; present,
    content =&gt; "this file name is not $var2 or $var3",
  }

  file { "/tmp/${var2}" :
    ensure  =&gt; present,
    content =&gt; "this file name is not $var1 or $var3",
  }

}
</code></pre>
<p>[root@master modules]# cat definedmod/tests/init.pp</p>
<pre><code>include definedmod

[root@node4 ~]# cat /tmp/variable1 
this file name is not twovar or thirdvariable

[root@node4 ~]# cat /tmp/twovar 
this file name is not variable1 or thirdvariable

[root@node4 ~]# cat /tmp/thirdvariable 
this file name is not variable1 or twovar[root@node4 ~]#
</code></pre>
<p></br></p>
<hr />
<h3 id="resource-duplicates">Resource duplicates</h3>
<p>Instances of <strong>type + title</strong> must be singleton/unique for each node, otherwise the nodes catalog will fail to compile.</p>
<p>sample duplicate resource declarations:</p>
<pre><code>class resourceduplicates {
  user { 'user1': # duplicate title of the user resource below; 
                  # the nodes catalog will fail to compile.
    ensure =&gt; 'present',
    uid    =&gt; '1007',
  }

  user { 'user1':
    ensure =&gt; 'present',
    uid    =&gt; '1007', # duplicate UID's, puppet catalog will compile; 
  }                   # But the useradd provider will fail on the client.
}
</code></pre>
<p>sample error of duplicate resource:</p>
<blockquote>
<p>Error: Could not retrieve catalogue from remote server: Error 400 on SERVER: Duplicate declaration: User[user2] is already declared in file</p>
</blockquote>
<h3 id="resource-refresh">Resource refresh</h3>
<p>Puppet will refresh a service for each instance of a refresh, e.g if 3 files are being updated and each update triggers a refresh of the same service 3 separate refreshes will be triggered doe each of the file updates.</p>
<pre><code># This is a test to see if puppet will restart a service multiple time or-
# just once when multiple refresh events are triggered
class loop {

   file { '/tmp/loop1' :
     ensure  =&gt; present,
     content =&gt; "$::uptime_seconds \n", # the "uptime_seconds" is used here to ensure that
   }                                    # the content of the file will change upon each run

   file { '/tmp/loop2' :
     ensure  =&gt; present,
     content =&gt; "$::uptime_seconds \n",
   }

   file { '/tmp/loop3' :
     ensure  =&gt; present,
     content =&gt; "$::uptime_seconds \n",
   }

   service { 'crond' :
     ensure =&gt; running,
   }

   File['/tmp/loop1'] ~&gt; Service['crond']
   File['/tmp/loop2'] ~&gt; Service['crond']
   File['/tmp/loop3'] ~&gt; Service['crond']

}
</code></pre>
<h3 id="resource-ordering-and-relationships-with-metaparameters">Resource ordering and relationships with <strong>metaparameters</strong></h3>
<p>Via a mechanism called <strong>autorequires</strong>; For some of the built in resource types such as users and groups, Puppet is able to automatically determine the dependency relationships among some of the built-in resources such as user and groups  without a user/admin having to declare the resource interdependencies.</p>
<p>For the majority of resources there is no autorequire and therefore the order of resources in a puppet manifest is generally ignored.
If a group of resources have interdependencies you should use one of the metaparameters to specify the relationships between them</p>
<ul>
<li><strong>before</strong>    - Causes a resource to be applied before the target resource</li>
<li><strong>require</strong>   - Causes a resource to be applied after the target resource</li>
<li><strong>notify</strong>    - Causes a resource to be applied before the target resource.
              The target resource will refresh if the notifying resource changes.</li>
<li><strong>subscribe</strong> - Causes a resource to be applied after the target resource.
              The subscribing resource will refresh if the target resource changes.</li>
</ul>
<p>Note: when creating a resource reference use the syntax</p>
<pre><code>Type['title']
</code></pre>
<p>Note: Use lower-case for the type name when declaring it but use a capitalised type name when calling it.</p>
<p><strong>metaparameter declaration examples...</strong></p>
<h4 id="before">before</h4>
<pre><code>  package { 'openssh-server':
    ensure =&gt; present,
    before =&gt; File['/etc/ssh/sshd_config'],
  }
</code></pre>
<h4 id="require">require</h4>
<pre><code>  file { '/etc/ssh/sshd_config':
    ensure  =&gt; file,
    mode    =&gt; 600,
    source  =&gt; 'puppet:///modules/sshd/sshd_config',
    require =&gt; Package['openssh-server'],
  }
</code></pre>
<h4 id="ordering-arrows">Ordering Arrows</h4>
<pre><code> Package['openssh-server'] -&gt; File['/etc/ssh/sshd_config']
</code></pre>
<p>Causes the resource on the left to be applied before the resource on the right.</p>
<h4 id="notify">notify</h4>
<pre><code> file { '/etc/ssh/sshd_config':
   ensure  =&gt; file,
   mode    =&gt; 600,
   source  =&gt; 'puppet:///modules/sshd/sshd_config',
   notify  =&gt; Service['sshd'],
 }
</code></pre>
<h4 id="subscribe">subscribe</h4>
<pre><code> service { 'sshd':
   ensure    =&gt; running,
   enable    =&gt; true,
   subscribe =&gt; File['/etc/ssh/sshd_config'],
 }
</code></pre>
<h4 id="notification-arrow">Notification Arrow</h4>
<pre><code> File['/etc/ntp.conf'] ~&gt; Service['ntpd']
</code></pre>
<p>Causes the resource on the left to be applied first and sends a refresh to the resource on the right if the resource on the left changes.</p>
<p>Complete example</p>
<pre><code>class sshd {

  package { 'openssh-server':
    ensure =&gt; present,
    before =&gt; File['/etc/ssh/sshd_config'],
  }

  file { '/etc/ssh/sshd_config':
    ensure =&gt; file,
    mode   =&gt; '0600',
    source =&gt; 'puppet:///modules/sshd/sshd_config',
  }
}

  service { 'ssh':
    ensure    =&gt; running,
    enable    =&gt; true,
    subscribe =&gt; File['/etc/ssh/sshd_config'],
}
</code></pre>
<h3 id="extra-metaparameters">extra metaparameters..</h3>
<p>Manage dependencies (before, require, subscribe, notify, stage)</p>
<p>Manage resources' application policies (audit, noop, schedule, loglevel)</p>
<p>Add information to a resource (alias, tag)</p>
<h3 id="virtual-resources">Virtual resources</h3>
<p>are a hack to get around puppets limitation of sigleton resource definitions. They enable an a particular instance of a resource type+title to be used in multiple classes. </p>
<p>They are defined as virtual by pre-pending them with the "@" symbol</p>
<pre><code>@user { seamus: ensure =&gt; present }
</code></pre>
<p>They can then be declared in multiple classes by using one of the following 3 syntaxes using either the realise function or the spaceship collector.</p>
<pre><code>User &lt;| title == seamus |&gt;
realize User[seamus]
realize(User[seamus])
</code></pre>
<h3 id="exported-resources">Exported resources</h3>
<p>Enable a resource that is defined on  a host to be exported to the puppetdb and then be used by 1 or more other hosts. Puppet collects and stores the exported resources during configuration runs.</p>
<p>/etc/hosts example</p>
<p>[root@master modules]# cat exportedresource/manifests/init.pp</p>
<pre><code>class exportedresource {
  @@host { $hostname:  ## sends the local nodes host resource to the puppetdb and 
                       ## tags it as exported
    ip           =&gt; $::ipaddress,
    name         =&gt; $::fqdn,
    host_aliases =&gt; $::hostname,
    comment      =&gt; 'addded by the exported resource class',
   }
  Host &lt;&lt;| |&gt;&gt;  ## retrieves all the host resources from the puppetdb
}
</code></pre>
<p>SSH example</p>
<pre><code>class ssh::hostkeys {

  @@sshkey { "${::fqdn}_dsa":
    host_aliases =&gt; [ $::fqdn, $::hostname, $::ipaddress ],
    type         =&gt; dsa,
    key          =&gt; $::sshdsakey,
  }

  @@sshkey { "${::fqdn}_rsa":
    host_aliases =&gt; [ $::fqdn, $::hostname, $::ipaddress ],
    type         =&gt; rsa,
    key          =&gt; $::sshrsakey,
  }

}
</code></pre>
<p>SSH example of retrieving the exported resources and applying them</p>
<pre><code>class ssh::knownhosts {
  Sshkey &lt;&lt;| |&gt;&gt; { ensure =&gt; present }
}
</code></pre>
<p>The ssh::knownhosts class should be included in the catalog for all nodes where Puppet should manage the SSH known_hosts file.
Notice that we’ve used double angle braces to collect resources from PuppetDB.</p>
<pre><code>define balancermember($url) {
  file { '/etc/httpd/conf.d.members/worker_${name}.conf':
    ensure  =&gt; file,
    owner   =&gt; 'root',
    group   =&gt; 'root',
    mode    =&gt; '0644',
    content =&gt; "BalancerMember $url \n",
  }
}
</code></pre>
<p>This configuration file fragment contains a single line, the URL to a member of the load balancer pool.
Puppet recommends using a defined resource type because all resources declared within the type will be exported when the defined type itself is exported.</p>
<pre><code>class loadbalancer_members {
   Balancermember &lt;&lt;| |&gt;&gt; { notify =&gt; Service['apache'] }
}
</code></pre>
<p>This code uses the double angle brace syntax to collect all balancermember resources from the stored configuration database.   In addition, it uses a parameter block to notify the Apache service of any changes Puppet makes to the balancermember resources. Just as with virtual resources, a parameter block may be specified to add further parameters to collected resources.</p>
<p><strong>Removing retired nodes from PuppetDB</strong></p>
<pre><code># puppet node deactivate mail.example.com
Submitted 'deactivate node' for &lt;node_name&gt; with UUID aaaaa-bbbbb-ccccc-ddddd-eeee
</code></pre>
<p>After you’ve run this on the puppet master, any resources exported by this node will no longer be collected on your Puppet clients.
Note:  Deactivated node resources will not be removed from the systems that collected them.
You will need to clean up those configurations manually; or some resources can be purged using the resource metatype.</p>
<h3 id="exec-resource">Exec Resource</h3>
<p>Exec resources execute external commands, it is important that any commands executed are Idempotent</p>
<p>Any command in an  exec resource must be able to be run multiple times without casing harm.
There are 3 main ways for commands in exec resources to be idempotent
1. The commands them selves can be idempotent
2. You use an (onlyif, unless, or creates) attribute, which will prevent puppet from running a specific command unless a specific condition is met.
3. The exec resource has the ( refreshonly=&gt;true ) value, which only allows puppet to run the command when some other resource is changed</p>
<p><strong>syntax</strong></p>
<pre><code> exec { 'resource-title':
   attribute_1 =&gt; value_1,
   attribute_2 =&gt; value_2,
 }
</code></pre>
<p><strong>example</strong></p>
<pre><code>exec { "updatedb':
  path    =&gt; '/usr/sbin',
  command =&gt; 'updatedb',
}
</code></pre>
<p>Note: if you do not set the command value it will default to the exec resource title. You must specifiy the path because the exec resource does not inherit paths.</p>
<hr />
<p></br></br></br></br></br></br></p>
<h2 id="classes">Classes</h2>
<p>Classes define a collection of resources that are managed together as a single unit. You can also think of them as named blocks of Puppet code, which are created in one place and invoked elsewhere.</p>
<p>Using a Puppet class requires two steps.</p>
<ol>
<li>First, you'l need to define it by writing a class definition and saving it in a manifest file. When Puppet runs, it will parse this manifest and store your class definition.</li>
<li>Secondly, The class can then be declared to apply it to nodes in your infrastructure.</li>
</ol>
<p>example class for ssh that contains 3 resources { package, file, service}..</p>
<pre><code>resource     class

package  \
file      &gt;-  ssh
service  /
</code></pre>
<p>Example class syntax....{with no relationships defined}</p>
<pre><code>class ssh {
  package  { 'openssh-clients':
    ensure  =&gt; present,
  }

  file { '/etc/ssh/ssh_config':
    ensure  =&gt; file,
    owner   =&gt; 'root',
    group   =&gt; 'root',
    source  =&gt; 'puppet:///modules/ssh/ssh_config',
  }

  service { 'sshd':
    ensure  =&gt; running,
    enable  =&gt; true,
  }
}
</code></pre>
<p>Defining a class specifies the contents and behaviour but does not automatically include (apply) it in a configuration</p>
<p>Declaring a class, includes the class in the catalogue which will then be applied upon next agent run.</p>
<p>To declare a class use either of the following syntaxes in site.pp.. or in <modulename>/tests/init.pp</p>
<p>**   include my_calss **
or
 **   class { 'my_class': } **</p>
<ul>
<li>classes are reusable</li>
<li>classes are singleton</li>
<li>classes can only be used once per node</li>
</ul>
<p>When applying a class make sure you run</p>
<pre><code>puppet apply module/tests/init.pp
</code></pre>
<p>and NOT</p>
<pre><code>puppet apply module/manifest/init.pp
</code></pre>
<p>otherwise no actions will take place and no errors will be logged, this is because you would be defining the class but not declared it anywhere (on a  node).</p>
<h3 id="parameterised-classes">Parameterised Classes</h3>
<p>Class parameters provide a method to set variables in a class as it's declared.
The syntax for parameterised classes is similar to resource declarations.</p>
<pre><code>class { 'ntp':
  servers =&gt;
  ['node1.example.com','node2.example.com','node3.example.com']
}
</code></pre>
<p>The servers parameter can be populated with a single server or an array of servers.</p>
<p>Parameterised class definitions can be set in the site.pp file.</p>
<pre><code>node default {
  # This is where you can declare classes for all nodes.
  # Example:
  #   class { 'my_class': }
  class { 'ntp':
    servers =&gt;
    ['node1.example.com','node2.example.com','node3.example.com']
  }
}
</code></pre>
<p>You can also override values with</p>
<pre><code>class { '::mysql::server':
  override_options =&gt; { 'mysqld' =&gt; { 'max_connections' =&gt; '1024' } },
}
</code></pre>
<h3 id="class-inheritance-derived-classes">Class Inheritance / Derived Classes</h3>
<p>By using the inherits keyword classes can be derived from other classes.</p>
<p>When a derived class is declared, its base class is automatically declared first and the variable are set as the parent scope.
The new class receives a copy of all the base class's variables and resource defaults.
Code in the derived class is able to override any resource attributes that were originally set in the base class.</p>
<p>Class Inheritance is only useful for overriding resource attributes. For any other use case it is better archive your objective by using  some other method.</p>
<p><strong>example...</strong></p>
<p>We create a new class zsh::developer that will enable us to deploy the zshrc.dev file instead of the zshrc file on certain nodes..</p>
<pre><code>[root@learn modules]# tree zsh/
zsh/
├── files
│   ├── zshrc
│   └── zshrc.dev
├── manifests
│   ├── developer.pp
│   └── init.pp
├── Modulefile
├── README
├── spec
│   └── spec_helper.rb
└── tests
    ├── developer.pp
    └── init.pp
</code></pre>
<p>cat zsh/manifests/init.pp</p>
<pre><code>class zsh {
  package { 'zsh':
    ensure =&gt; present,
    before =&gt; File['/etc/zshrc'],
  }
  file { '/etc/zshrc':
    ensure =&gt; file,
    owner  =&gt; 'root',
    group  =&gt; 'root',
    source =&gt; 'puppet:///modules/zsh/zshrc',
  }
}
</code></pre>
<p>[root@learn modules]# cat zsh/manifests/developer.pp</p>
<pre><code>#Note there is no need for a "package { 'zsh':" resource definition here as it will be inherited from the zsh class
class zsh::developer inherits zsh {
  File ['/etc/zshrc'] {
    source =&gt; 'puppet:///modules/zsh/zshrc.dev',
    }
}
</code></pre>
<p>[root@learn modules]# cat zsh/tests/init.pp</p>
<pre><code>include zsh
</code></pre>
<p>[root@learn modules]# cat zsh/tests/developer.pp</p>
<pre><code>include zsh::developer
</code></pre>
<h3 id="variables-and-class-parameters">Variables and Class  Parameters</h3>
<p><strong>Variables</strong> are prefixed with the $ sign and assigned with the = operator</p>
<pre><code>$mystring = 'this is my string'
$mypath   = '/tmp/puppet/'
</code></pre>
<p>Once a variable it is defined it can be used anywhere in the manifest in place of an regular assigned value.</p>
<ul>
<li>
<p>Unlike resource declarations, variable assignments are parse-order dependent. This means that you must assign a variable in your manifest before you can use it.</p>
</li>
<li>
<p>If you try to use a variable that has not been defined, the Puppet parser won't complain. Instead, Puppet will treat the variable as having the special undef value.</p>
</li>
<li>
<p>You can only assign a variable once within a single scope. Once it's assigned, the value cannot be changed. 
(therefore it should be called a constant but hey its not like the puppet people actually follow best practices or common conventions anywhere else so why would this be any different)</p>
</li>
</ul>
<p><strong>Variable interpolation</strong> enables a string that is stored as a variable to be inserted into another string. eg..</p>
<pre><code>file { "${mypath}file1.txt":
  ...
}
file { "${mypath}file2.txt":
  ...
}
</code></pre>
<p><strong>Note:</strong> A string that includes an interpolated variable must be wrapped in double quotation marks ("..."), rather than the single quotation marks that surround an ordinary string</p>
<p><strong>Class Parameters</strong> provide a method of setting the variables within a class when the class is declared rather than when it is defined.</p>
<p>Once defined a <strong>Parameterised Class</strong> can be declared with a similar syntax to a resource declaration</p>
<p>When defining a class, include a list of parameters and optional default values between the class name and the opening curly brace. So a parameterised class is defined as below:</p>
<pre><code>class classname ( $parameter = 'default' ) {
  ...
 }
</code></pre>
<p>Once defined, a parameterised class can be declared with a syntax similar to that of resource declarations, including key value pairs for each parameter you want to set.</p>
<pre><code>class {'classname':
  parameter =&gt; 'value',
}
</code></pre>
<p>Seamus sample module using defined resource type class with paramaters (as described in the "defined resource section above"</p>
<p>[root@master modules]# tree definedmod</p>
<pre><code>definedmod
├── manifests
│   ├── definedresource.pp
│   └── init.pp
└── tests
    └── init.pp
</code></pre>
<p>[root@master modules]# cat definedmod/manifests/init.pp</p>
<pre><code>class definedmod {
  definedresource {'mydefinedresource':
         var2 =&gt; 'twovar',
         var1 =&gt; 'variable1',
         var3 =&gt; 'thirdvariable',
  }
}
</code></pre>
<p>[root@master modules]# cat definedmod/manifests/definedresource.pp</p>
<pre><code>define definedresource ($var1, $var2 = default2 , $var3 = default3) {

  file { "/tmp/${var1}" :
    ensure  =&gt; present,
    content =&gt; "this file name is not $var2 or $var3",
  }

  file { "/tmp/${var2}" :
    ensure  =&gt; present,
    content =&gt; "this file name is not $var1 or $var3",
  }

}
</code></pre>
<p>[root@master modules]# cat definedmod/tests/init.pp</p>
<pre><code>include definedmod

[root@node4 ~]# cat /tmp/variable1 
this file name is not twovar or thirdvariable

[root@node4 ~]# cat /tmp/twovar 
this file name is not variable1 or thirdvariable

[root@node4 ~]# cat /tmp/thirdvariable 
this file name is not variable1 or twovar[root@node4 ~]#
</code></pre>
<hr />
<p></br></br></br></br></br></br></p>
<h2 id="puppet-lint">puppet-lint</h2>
<p>A 3rd party tool used to display common syntax and style errors. Packaged as a ruby gem.</p>
<pre><code>gem install puppet-lint

puppet-lint /etc/puppetlabs/puppet/modules/ntplint/manifests/init.pp
</code></pre>
<p>you can ignore certain syntax checks</p>
<p>on command line</p>
<pre><code>puppet-lint  &lt;path&gt;/&lt;file&gt;.pp --no-80chars-check
puppet-lint  &lt;path&gt;/&lt;file&gt;.pp --no-ensure_first_param-check
</code></pre>
<p>~/.puppet-lint.rc</p>
<pre><code>--no-80chars-check
--no-ensure_first_param-check
</code></pre>
<p>using a rake file to test multiple manifests in one go by including the following values in your rake file</p>
<pre><code>require 'puppet-lint/tasks/puppet-lint'
PuppetLint.configuration.send("disable_&lt;check&gt;")
</code></pre>
<h2 id="idempotency">Idempotency</h2>
<p>By default puppet modules describe the desired final state rather than detail a series of step to follow, this mean that no matter how many times they are run the same end state will occur.</p>
<hr />
<p></br></br></br></br></br></br></p>
<h2 id="puppet-console">Puppet Console</h2>
<p>The puppet enterprise console is a web-based gui. It can help..</p>
<ul>
<li>manage node requests to join the puppet deployment</li>
<li>assign puppet classes to nodes and groups</li>
<li>view reports and activity graphs</li>
<li>browse and compare resources on your nodes</li>
<li>view inventory data</li>
<li>manage console users and their access privileges</li>
</ul>
<h3 id="event-inspector">Event Inspector</h3>
<p>The Event Inspector is part of the Puppet Enterprise (PE) Console. 
It is a reporting tool that provides data for investigating the current state of your infrastructure. 
Its focus is on correlating information and presenting it from multiple perspectives, in order to reveal common causes behind related events.
Event inspector lets you accomplish two important tasks: monitoring a summary of your infrastructure’s activity and analyzing the details of important changes and failures.
It displays events from three perspectives Classes Nodes and Resources</p>
<h2 id="resetting-the-admin-user-password">Resetting the admin user password</h2>
<p>This must be performed from a shell session on the console server and executing a ruby script that was part of the Puppet Enterprise installer.</p>
<blockquote>
<p>q_puppet_enterpriseconsole_auth_password=newpassword 
q_puppetagent_certname=$(puppet config print certname) 
/opt/puppet/bin/ruby update-superuser-password.rb</p>
</blockquote>
<h2 id="environments">Environments</h2>
<p>By default, all nodes are assigned to a default environment named production.</p>
<p>There are three ways to assign nodes to a different environment:</p>
<ul>
<li>Via your ENC or node terminus</li>
<li>Via each agent node’s puppet.conf</li>
<li>Via the PE console to set the environment for each node group.</li>
</ul>
<p><strong>Assigning Environments Via an ENC</strong></p>
<p>The interface to set the environment for a node will be different for each ENC. Some ENCs cannot manage environments.</p>
<p>When writing an ENC, simply ensure that the environment: key is set in the YAML output that the ENC returns. See the documentation on writing ENCs for details.</p>
<p>If the environment key isn’t set in the ENC’s YAML output, the Puppet master will just use the environment requested by the agent.
Assigning Environments Via the Agent’s Config File</p>
<p><strong>Assigning Environment via agent config</strong></p>
<p>In puppet.conf on each agent node, you can set the environment setting in either the agent or main config section.
When that node requests a catalog from the Puppet master, it will request that environment.
Note: If you are using an ENC and it specifies an environment for that node, it will override whatever is in the config file.</p>
<p><strong>Assigning Environments via PE console</strong>
Click Classification
   - select node group
       - click "edit node group metadata"
          - select enviroment</p>
<hr />
<p></br></br></br></br></br></br></p>
<h2 id="scope">Scope</h2>
<p>Scope helps to organise classes, telling Puppet where to look within the module directory structure to find each class. It also separates namespaces within the module and your Puppet manifests, preventing conflicts between variables or classes with the same name.</p>
<p>The init.pp in the <modulename>/manifest/ directory must contain a class with the same name as the module name</p>
<p>Class name   =  mysql
File location =  /modules/mysql/manifests/init.pp    )</p>
<p>Class name   =  mysql::server
File location = /modules/mysql/manifests/server.pp</p>
<p>Class name    =  mysql::server::account_security
File location = /modules/mysql/manifests/server/account_security.pp</p>
<hr />
<p></br></br></br></br></br></br></p>
<h2 id="types-and-providers">Types and Providers</h2>
<p>A <strong>type</strong> defines the interface for a resource: the set of properties you can use to define a desired state for the resource, and the parameters that don't directly map to things on the system, but tell Puppet how to manage the resource.
Both properties and parameters appear in the resource declaration syntax as attribute value pairs.</p>
<p>command to show the types available</p>
<pre><code>[root@master ~]# puppet resource --type

+-----------------------------------------------------------------------------+
| anchor            |  mcx                        |   puppetdb_conn_validator |
| apt_key           |  mount                      |   resources               |
| augeas            |  nagios_command             |   router                  |
| computer          |  nagios_contact             |   schedule                |
| cron              |  nagios_contactgroup        |   scheduled_task          |
| exec              |  nagios_host                |   selboolean              |
| file              |  nagios_hostdependency      |   selmodule               |
| file_line         |  nagios_hostescalation      |   service                 |
| filebucket        |  nagios_hostextinfo         |   ssh_authorized_key      |
| firewall          |  nagios_hostgroup           |   sshkey                  |
| firewallchain     |  nagios_ser^ice             |   stage                   |
| group             |  nagios_ser|icedependency   |   tidy                    |
| host              |  nagios_ser|iceescalation   |   user                    |
| ini_setting       |  nagios_ser|iceextinfo      |   vlan                    |
| ini_subsetting    |  nagios_servicegroup        |   whit                    |
| interface         |  nagios_timeperiod          |   yumrepo                 |
| k5login           |  notify                     |   zfs                     |
| macauthorization  |  package                    |   zone                    |
| mailalias         |  postgresql_conf            |   zpool                   |
| maillist          |  postgresql_psql            |                           |
+-----------------------------------------------------------------------------+
</code></pre>
<h3 id="core-types">Core Types</h3>
<h4 id="file">File</h4>
<p>manages local files and ensures if a file should exist sets its parameters
present / absent
file / directory / link
source puppet:///modules/<modulename></p>
<h4 id="package">Package</h4>
<p>Manages software packages
ensures that a package is present / absent / latest /purged / version</p>
<h4 id="service">Service</h4>
<p>Manages services
ensures running / stopped
enable true / false</p>
<h4 id="notify_1">notify</h4>
<p>echo's message to the agent run-time log
 message =&gt; " hello world ! ",</p>
<h4 id="exec">exec</h4>
<p>executes an arbitrary command on the agent node.</p>
<h4 id="cron">cron</h4>
<p>manages cron jobs</p>
<h4 id="user">user</h4>
<p>manages user accounts
ensure present / absent / role
name, uid, gid, groups,  home, shell</p>
<h4 id="group">group</h4>
<p>ensure present / absent
name, gid
A <strong>provider</strong> is what does the heavy lifting to bring the system into line with the state defined by a resource declaration.
Providers are implemented for a wide variety of supported operating systems.
They are a key component of the Resource Abstraction Layer (RAL), translating the universal interface defined by the type into system-specific implementations.</p>
<h3 id="resource-abstraction-layer_1">Resource Abstraction Layer</h3>
<pre><code>   +---------------------------------------+
   | file | package | service  |  user     |  Resources
   |---------------------------------------|
   | Ruby | Apt     | Redhat   | Useradd   |  Providers
   |      | Yum     | Launchd  | LDAP      |
   |      | Gems    | SMF      | Netinfo   |
   |      | Deb     | Debian   |           |
   |      | RPM     |          |           |
   +---------------------------------------+
</code></pre>
<hr />
<p></br></br></br></br></br></br></p>
<h2 id="conditional-statements">Conditional Statements</h2>
<p>**Note: ** string matches are not case sensitive</p>
<h3 id="if-optional-elseif-and-else">if   (optional elseif and else)</h3>
<pre><code>class accounts ($name) {

  if $::operatingsystem == 'centos' {
    $groups = 'wheel'
  }
  elsif $::operatingsystem == 'debian' {
    $groups = 'admin'
  }
  else {
    fail( "This module doesn't support ${::operatingsystem}." )
  }

  notice ( "Groups for user ${name} set to ${groups}" )

  ...

}
</code></pre>
<h3 id="unless">unless</h3>
<pre><code>unless $memorysize &gt; 1024 {
  $maxclient = 500
 }
</code></pre>
<h3 id="case">case</h3>
<pre><code>case $::operatingsystem {
  'CentOS': { $apache_pkg = 'httpd' }
  'Redhat': { $apache_pkg = 'httpd' }
  'Debian': { $apache_pkg = 'apache2' }
  'Ubuntu': { $apache_pkg = 'apache2' }
  default: { fail("Unrecognised operating system for webserver.") }
}

package { $apache_pkg :
  ensure =&gt; present,
}
</code></pre>
<h3 id="selector">selector</h3>
<p>Selector statements are similar to case statements, but return a value instead of executing a code block.
Selectors can only be used at places in the code where a plain value is expected an not inside another selector or case statement.</p>
<pre><code>$rootgroup = $::osfamily ? {
  'Solaris'  =&gt; 'wheel',
  'Darwin'   =&gt; 'wheel',
  'FreeBSD'  =&gt; 'wheel',
  'default'  =&gt; 'root',
}
</code></pre>
<h3 id="my-sample-class-with-all-the-selectors">my sample class with all the selectors</h3>
<p>[root@pe-puppet modules]# cat  noticemod/manifests/init.pp </p>
<pre><code>class noticemod {
  notify { "Hello World!": }

## SELECTOR statement
  notify { " SELECTOR warning !":
    message =&gt; $seamus ? {
      'mytrue' =&gt; " the value is true.",
      'myfalse' =&gt; " the value is false.",
      default =&gt; " the value is not set.",
      }, # selector statements warn you if no match is found and there is no default
  }

## CASE statement
  case $seamus {
    'mytrue':   { notify { " CASE warning ! the value is true.": } }
    'myfalse':  { notify { " CASE warning ! the value is false.": } }
    default: { fail(" CASE warning ! failing now... if the variable is undef the whole catalog compile will fail") }
  } # case statements silently fall through the bottom if no match is found


## IF statement 
  if 'rue' in $seamus {
      notify { " IF warning ! the value is true.": } 
  }
  elsif 'alse' in $seamus {
      notify { " IF  warning ! the value is false.": } 
  }
  else {
      notify { " IF  warning ! the value does not match.": }
  }


## UNLESS statement

  unless $seamus == 'myfalse' {
    notify { " UNLESS statement - \$seamus does not == myfalse, it is set to $seamus ": } 
  }

  unless $seamus == 'mytrue' {
    notify { " UNLESS statement - \$seamus does not == mytrue, it is set to $seamus ": } 
  }


}
</code></pre>
<hr />
<p></br></br></br></br></br></br></p>
<h2 id="puppetdb">PuppetDB</h2>
<ul>
<li>stores the most recent facts from every node</li>
<li>the most recent catalog from every node</li>
<li>(optionally) 7 days of event reports from every node</li>
</ul>
<p>it is searchable using either...</p>
<ul>
<li>PuppetDB's query API</li>
<li>Puppet's inventory service</li>
<li>exported resources</li>
</ul>
<p><strong>example</strong></p>
<p>[root@learning ~]# puppet node status learning.puppetlabs.vm
learning.puppetlabs.vm
Currently active
Last catalog: 2015-01-24T13:31:16.291Z
Last facts: 2015-01-24T13:31:03.782Z</p>
<p>Declaring an exported resource causes that resource to be added to the catalog and marked with an “exported” flag, which prevents the puppet agent from managing the resource. When PuppetDB receives the catalog, it stores a record for each resource with the flag set.</p>
<p>Delete reports older then 1 month :</p>
<pre><code>sudo -u puppet-dashboard rake RAILS_ENV=production reports:prune upto=1 unit=mon
</code></pre>
<p></br></br></br></br></br></br></p>
<hr />
<h2 id="hiera">Hiera</h2>
<p>https://ask.puppetlabs.com/question/13592/when-to-use-hiera-hiera_array-and-hiera_hash/</p>
<p>Hiera is a key/value lookup tool for configuration data, built to make puppet better and let you set node-specific data without repeating yourself.
Hiera support is built into puppet 3, and is available as an add-on for puppet 2.7.</p>
<p>It keeps site specific data out of the manifest.
Puppet classes can query any data they need and hiera will act as a site wide config file.</p>
<p>Hiera makes it easier to:
1. separate configuration data from the modules code.
2. configure your own nodes: default data with multiple levels of overrides.
3. re-use public puppet modules: you don't have to edit the code you just have to put the necessary data in hiera.
4. makes it easier to publish your own developed modules to the forge without clashing variable names or having to redact your config values.
5. create common data for most nodes and..
         - Override some values for machines located at a particular facility
         - Override some values for specific machines
6. enables you to only write down the differences that are needed (doesn't make sense)</p>
<p>To get started with hiera there are 5 steps..
1) download and install hiera
2) create a hiera.yaml config file
3) arrange a hierachy that suite your site and data
4) write your data sources
5) configure puppet to use hiera</p>
<p>https://ask.puppetlabs.com/question/13592/when-to-use-hiera-hiera_array-and-hiera_hash/
hiera - Performs a standard priority lookup and returns the most specific value for a given key. The returned value can be data of any type (strings, arrays, or hashes).</p>
<p>hiera_array - Returns all matches throughout the hierarchy — not just the first match — as a flattened array of unique values. If any of the matched values are arrays, they’re flattened and included in the results.</p>
<p>hiera_hash - Returns a merged hash of matches from throughout the hierarchy. In cases where two or more hashes share keys, the hierarchy order determines which key/value pair will be used in the returned hash, with the pair in the highest priority data source winning.</p>
<p>example of using hiera....</p>
<p>[root@learn ~]# vim  /etc/puppetlabs/puppet/hieradata/common.yaml</p>
<pre><code>---
message: This string is the value that is returned when hiera('message') is called.
motd:  Hello there Seamus
</code></pre>
<p><strong>test that the key is set correctly using the puppet apply -e</strong></p>
<pre><code>[root@learn hieradata]# puppet apply -e 'notice(hiera("motd"))'
Notice: Scope(Class[main]): Hello there Seamus
Notice: Compiled catalog for learn.puppetlabs.com in environment production in 0.04 seconds
Notice: Finished catalog run in 0.02 seconds
</code></pre>
<p><strong>Edit the motd module to use the key from hiera instead of the value in the module files</strong></p>
<pre><code>[root@learn hieradata]# cd /etc/puppetlabs/puppet/modules/
[root@learn modules]# tree motd/
motd/
├── manifests
│   └── init.pp
├── Modulefile
├── README
├── spec
│   └── spec_helper.rb
└── tests
    └── init.pp
</code></pre>
<p>[root@learn modules]# vim motd/manifests/init.pp</p>
<pre><code>  Class: motd

class motd {

  file { '/etc/motd':
    ensure  =&gt; file,
    owner   =&gt; 'root',
    group   =&gt; 'root',
    content =&gt;  (hiera("motd")),
  }

}
</code></pre>
<p>[root@learn modules]# puppet parser validate motd/manifests/init.pp
[root@learn modules]# puppet apply motd/tests/init.pp
Notice: Compiled catalog for learn.puppetlabs.com in environment production in 0.09 seconds
Notice: /Stage[main]/Motd/File[/etc/motd]/ensure: defined content as '{md5}13c0016553b5315a8cd66f13b23f14a3'
Notice: Finished catalog run in 0.03 seconds</p>
<p>[root@learn modules]#  cat /etc/motd</p>
<pre><code>Hello there Seamus
</code></pre>
<hr />
<p></br></br></br></br></br></br></p>
<h2 id="facter">Facter</h2>
<p>Facter stores facts as pairs of keys and values.</p>
<h3 id="facter-command-line-options">Facter command line options</h3>
<pre><code>-y, --yaml                       Emit facts in YAML format.
-j, --json                       Emit facts in JSON format.
    --plaintext                  Emit facts in plaintext format.
    --trace                      Enable backtraces.
    --external-dir DIR           The directory to use for external facts.
    --no-external-dir            Turn off external facts.
-d, --debug                      Enable debugging.
-t, --timing                     Enable timing.
-p, --puppet                     Load the Puppet libraries, thus allowing Facter to load Puppet-specific facts.
-v, --version                    Print the version and exit.
-h, --help                       Print this help message.
</code></pre>
<p>A shell enviroment variable prepened with the name <strong>FACTER_</strong>   will be readable by facter as a fact. eg...</p>
<pre><code>[root@node1 ~]# export FACTER_seamus=murray
[root@node1 ~]# facter seamus
murray
[root@node1 ~]# facter |grep seamus
seamus =&gt; murray
</code></pre>
<p>Facter values can be <strong>temporarily overridden</strong> by setting a shell variable prepended with <strong>FACTER_</strong> and the name of the fact. eg...</p>
<pre><code>FACTER_operatingsystem=Debian
</code></pre>
<p>You can even test the effect that the fake fact will have using puppet apply..</p>
<pre><code>FACTER_operatingsystem=Debian puppet apply --noop accounts/tests/init.p
</code></pre>
<p>The best way to distribute facts is to include them in your modules using the puppet plug-ins.
Puppet will distribute the custom facts, custom types, providers and functions to any host that includes the module.</p>
<p>you can either distribute the facts with the modules that need them or you can create a module combining all your custom facts needed by all your other modules.</p>
<p>Facter is called by the puppet agent.
Facts apear as normal and top scope variables they can be called by</p>
<pre><code>$ipaddress
</code></pre>
<p>or</p>
<pre><code>${::ipaddress}  (best practice)
</code></pre>
<h3 id="pluginsync">Pluginsync</h3>
<p>Custom Facts and types can be exported to the the agent nodes from the puppet master using the plugin sync mechanism.
Before the client requests a catlog it checks to see if the are any new plugins or if its plugins have been updated. 
If there has been a change it pulls down the plugins and executes the code in the custom types and facts.</p>
<p>This and be disabled from the agent nodes <strong>puppet.conf</strong> config file</p>
<pre><code>[main]
pluginsync = false
</code></pre>
<h3 id="custom-facts">Custom facts</h3>
<p>you can create a custom fact with a bit of ruby code on the puppet master and use plugins and modules to distribute it to the clients/nodes</p>
<p>Create a ruby file in</p>
<pre><code>&lt;modulename&gt;/lib/facter/&lt;modulename&gt;.rb
</code></pre>
<p>For simple shell commands, just insert the shell command in between the <strong>setcode do</strong> and the <strong>end</strong>.
For more complex comands use <strong>Facter::Core::Execution.exec('<command>')</strong> between the <strong>setcode do</strong> and the <strong>end</strong>.</p>
<pre><code>Facter.add('mycustomfact') do
  setcode do
    Facter::Core::Execution.exec('/bin/date')
  end
end
</code></pre>
<p>on the agents use plugin sync to automatically pull down the facts to  /var/lib/puppet/lib/facter/mycustomfact.rb</p>
<pre><code>puppet agent -t
</code></pre>
<p>use the <strong>-p</strong> facter flag to test the puppet fact</p>
<pre><code>facter -p  mycustomfact
</code></pre>
<p>A fact can be confined to run only if another fact is of a certain value</p>
<p>e.g.</p>
<pre><code>Facter.add(:powerstates) do
  confine :kernel =&gt; 'Linux'
  setcode do
    Facter::Core::Execution.exec('cat /sys/power/states')
  end
end
</code></pre>
<h3 id="external-facts">External facts</h3>
<p>Can be written in any language as long as they return key/value pairs to stdout.</p>
<p>They are stored in ..</p>
<pre><code>&lt;MODULEPATH&gt;/&lt;MODULE&gt;/facts.d/
</code></pre>
<p>and are distributed to the clients via the pluginsync mechanism.</p>
<p>Example fact written in bash...</p>
<pre><code>$ cat/etc/puppet/modules/myexternalfact/facts.d/myexternalfacts.sh
#!/bin/bash
echo "myexternalfact1=`/bin/df -P / |/usr/bin/tail -1 | /bin/awk '{print $5}'`"
echo "extfact1=one"
echo "extfact2=two"
echo "extfact3=three"
</code></pre>
<p>Calling the external fact from the command line on a node that has recieved  the external fact by pluginsync...</p>
<pre><code>$ facter --external-dir  /var/lib/puppet/facts.d/ extfact1 extfact2 extfact3 myexternalfact1
myexternalfact1 =&gt; 33%
extfact1 =&gt; one
extfact2 =&gt; two
extfact3 =&gt; three
</code></pre>
<p>Example fact written in c...</p>
<pre><code>#include &lt;stdio.h&gt;

int main() {
   printf("my_external_fact_in_c=\"Hello World\"\n");
 return 0;
}
</code></pre>
<p>Calling the external fact written in c...</p>
<pre><code># facter --external-dir ~/puppet-study/external-facts/ my_external_fact_in_c
"Hello World"
</code></pre>
<h3 id="distributing-the-external-facts-to-the-puppet-client-nodes">Distributing the external facts to the puppet client nodes</h3>
<p>It is best to put the external facts into a module so that they can be distributed to all the agent nodes via plugin sync..</p>
<pre><code>[root@master myexternalfact]# tree  /etc/puppet/modules/myexternalfact
/etc/puppet/modules/myexternalfact
└── facts.d
    ├── myexternalfactinc
    └── myexternalfact.sh


[root@master ~]# ls -l /etc/puppet/modules/myexternalfact/facts.d/
total 16
-rwxr-xr-x. 1 root root 8523 Feb 10 00:27 myexternalfactinc
-rwxr-xr-x. 1 root root  235 Feb 10 00:36 myexternalfact.sh
</code></pre>
<p>Trigger the plugin sync to trasfer the new external facts..</p>
<pre><code>[root@node1 ~]# puppet agent -t
</code></pre>
<p>Use the <strong>puppet apply -e</strong> tool on the agent nodes to test the facter values..</p>
<pre><code>[root@node1 ~]# puppet apply -e ' notice( "${::my_external_fact_in_c}" ) '
Notice: Scope(Class[main]): "Hello World"
Notice: Compiled catalog for node1.puppetlabs in environment production in 0.02 seconds
Notice: Finished catalog run in 0.03 seconds

[root@node1 ~]# puppet apply -e ' notice( "${::my_external_fact_in_bash_1}" ) '
Notice: Scope(Class[main]): 32%
Notice: Compiled catalog for node1.puppetlabs in environment production in 0.02 seconds
Notice: Finished catalog run in 0.03 seconds

[root@node1 ~]# puppet apply -e ' notice( "${::my_external_fact_in_bash_2}" ) '
Notice: Scope(Class[main]): two
Notice: Compiled catalog for node1.puppetlabs in environment production in 0.02 seconds
Notice: Finished catalog run in 0.03 seconds
</code></pre>
<h3 id="structured-facts">Structured facts</h3>
<p>Can come straight from YAML,JSON or txt files in the directories..</p>
<p><strong>/etc/facter/facts.d/</strong>  or <strong>/etc/puppetlabs/facter/facts.d/</strong></p>
<pre><code>$ cat /etc/facter/facts.d/mystructuredfact.yaml
---
mystructuredfact1: factone
mystructuredfact2: facttwo
mystructuredfact3: factthree

$ facter mystructuredfact1 mystructuredfact2 mystructuredfact3
mystructuredfact1 =&gt; factone
mystructuredfact2 =&gt; facttwo
mystructuredfact3 =&gt; factthree
</code></pre>
<hr />
<p></br></br></br></br></br></br></p>
<h2 id="roles-and-profiles">Roles and Profiles</h2>
<p>Roles and profiles are just modules written in a specific way.</p>
<ul>
<li>roles are assigned to nodes</li>
<li>profiles are assigned to roles</li>
</ul>
<h4 id="example-role">example role</h4>
<pre><code>class role::weibserver inherits role {
  include profile:: web
}

class role::dbserver inherits role {
  include profile::db
}

class role::webdbserver inherits role {
  include profile:web
  include profile::db
}
</code></pre>
<p>classification = assignment of classes to nodes
classification = assignment of roles to nodes</p>
<h4 id="example-profile">example profile</h4>
<pre><code>class profile::web {
  include apache
  include php
  include tomcat
  include jdk
  include memcache
}
</code></pre>
<p>__</p>
<p>Tip:  classes are singletons, they can be included multiple times on a node, but they will only be evaluated <strong>once</strong>. 
A defined class can be declared multiple times, because it takes parameters and each new declaration will be evaluated.</p>
<p>You can see we’ve included our two classes but not the definition, apache::vhost. This is because of some module magic called autoloading. 
Puppet scans your module and loads any .pp file in the manifests directory that is named after the class it contains; for example, the install.pp file contains the apache::install class and so is autoloaded.</p>
<p>The same thing happens with definitions: The vhost.pp file contains the definition apache::vhost, and Puppet autoloads it. However, as we declare definitions, for example calling apache::vhost where we need it, we don’t need to do an include apache::vhost because calling it implies inclusion.</p>
<p>...............................................</p>
<pre><code>class puppet::params {
  $puppetserver = hiera('puppetserver')
}
</code></pre>
<p>In Puppet 3, but not Puppet 2.7, there is an automatic lookup of parameters in a parameterized class. We can use this to rewrite the puppet::params class further:</p>
<pre><code>class puppet::params (
  $puppetserver,
){
}
</code></pre>
<p>When this is called with no arguments, Puppet 3 will attempt to look up the puppet::params::puppetserver key in Hiera and populate it accordingly. It will not fail unless the Hiera lookup fails.</p>
<hr />
<p></br></br></br></br></br></br></p>
<h2 id="puppet-templates">Puppet Templates</h2>
<p>Puppet supports templates written in the ERB templating language, which is part of the Ruby standard library.
Templates are always evaluated by the parser, not by the client. This means that if you are using a puppet master server, then the templates only need to be on the server, and you never need to download them to the client. The client sees no difference between using a template and specifying all of the text of the file as a string.
Note that the template function simply returns a string, which can be used as a value anywhere — the most common use is to fill file contents, but templates can also provide values for variables:</p>
<p>ags</p>
<p>The tags available in an ERB file depend on the way the ERB processor is configured. Puppet always uses the same configuration for its templates (see “trim mode” below), which makes the following tags available:</p>
<ul>
<li>** &lt;%= Ruby expression %&gt; ** — This tag will be replaced with the value of the expression it contains.</li>
<li>** &lt;% Ruby code %&gt; ** — This tag will execute the code it contains, but will not be replaced by a value. Useful for conditional or looping logic, setting variables, and manipulating data before printing it.</li>
<li>** &lt;%# comment %&gt;  ** — Anything in this tag will be suppressed in the final output.</li>
<li>** &lt;%% or %%&gt;  ** — A literal &lt;% or %&gt;, respectively.</li>
<li>** &lt;%- — Same as &lt;% ** , but suppresses any leading whitespace in the final output. Useful when indenting blocks of code for readability.</li>
<li>** -%&gt; ** — Same as ** %&gt; ** , but suppresses the subsequent line break in the final output. Useful with many lines of non-printing code in a row, which would otherwise appear as a long stretch of blank lines.</li>
</ul>
<h2 id="puppet-parser">Puppet parser</h2>
<p>Is the part of puppet that pareses the puppet DSL code in manifests files.
It can be called from the command line to validate your puppet code</p>
<pre><code>[root@pe-puppet]# puppet parser validate /etc/puppetlabs/puppet/modules/myexternalfact/manifests/init.pp 
  Error: Could not parse for environment production: Syntax error at '{'; expected '}' at /etc/puppetlabs/puppet/modules/myexternalfact/manifests/init.pp:3
</code></pre>
<hr />
<p></br></br></br></br></br></br></p>
<h2 id="functions">Functions</h2>
<p>Functions are extensions of the Puppet Parser. They are located and are executed on the master and only have access to resources and data that is available on the master. 
During the parsing of the manifest's any function code is executed and the subsequent return value/s are inserted into the resulting compilation.</p>
<h4 id="there-are-two-types-of-functions-statements-and-rvalues">There are two types of functions: statements and rvalues.</h4>
<ol>
<li>
<p><strong>Statements</strong>, such as the <strong>fail</strong> function, which stops the Puppet run with a parser error, perform some action.</p>
</li>
<li>
<p><strong>Rvalues</strong> return values and can be used anywhere a normal value is expected. (This includes resource attributes, variable assignments, conditions, selector values, the arguments of other functions, etc.) These values can come from a variety of places;</p>
<ul>
<li><strong>template</strong> function reads and evaluates a template to return a string.</li>
<li>stdlib’s <strong>str2bool</strong> and <strong>num2bool</strong> functions convert values from one data type to another.</li>
<li><strong>split</strong> function parses a string and returns array elements.</li>
</ul>
</li>
</ol>
<hr />
<p></br></br></br></br></br></br></p>
<h2 id="rbac-role-based-access-control">RBAC  Role Based Access Control</h2>
<p>Puppet enterprise ships with 3 default <strong>User Roles</strong></p>
<ul>
<li>Administrators</li>
<li>Operators</li>
<li>Viewers</li>
</ul>
<p>Todo.................................</p>
<p>Seamus learn the +&gt; operator</p>
<p>Does site.pp override the values in an enc?</p>
<p>Does the values in an enc override the values in a class?</p>
<p>Yumrepo['custom_packages'] -&gt; Package &lt;| tag == 'custom' |&gt;</p>
<p>Will create an order relationship with several package resources?</p>
<p>Using puppet node to set password when the nodes cant contact the password server, do you use an exec resource ?</p>
<p>Do you have to configure the agents to use heira or just the master?</p>
<p>What is a node_terminus where is it set and what overrides it</p>
<p>https://docs.puppetlabs.com/guides/external_nodes.html</p>
<p>Learn the spaceship operator</p>
<p>The puppet db has multiple terminus's where data is stored</p>
<ul>
<li>Facts</li>
<li>Catalogs</li>
<li>Resources</li>
</ul>
<p>Watch the puppetdb talk by james sweanie puppetny
https://www.youtube.com/watch?v=HTr4b02aU7A  at 14 mins</p>
<p>Do the values set in the console override enc or site.pp  (where are the values stored)
What is the effect of node default {} in site.pp can this be overridden by ENC or by a specific node hostname {} in site.pp</p>
<p>https://docs.puppetlabs.com/guides/external_nodes.html</p>
<p>Workout resource interdependency loops</p>
<p>............</p>
<p>sources of information I used to study</p>
<p>1) {book} pro puppet second edition </p>
<p>Last update:
(made some formatting changes on 13 Feb 2024)</p>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="../../linux/Software_Packaging/apt_get/" class="btn btn-neutral float-left" title="Apt get"><span class="icon icon-circle-arrow-left"></span> Previous</a>
        <a href="../../programming/C_Programming/fork_and_maloc_demo/" class="btn btn-neutral float-right" title="Fork and maloc demo">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
      <span><a href="../../linux/Software_Packaging/apt_get/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../../programming/C_Programming/fork_and_maloc_demo/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script src="../../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "../..";</script>
    <script src="../../js/theme_extra.js"></script>
    <script src="../../js/theme.js"></script>
      <script src="../../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
